<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Absensi Sekolah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .notification {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 h-full font-sans">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-md w-full space-y-8">
            <div class="text-center">
                <div class="mx-auto h-20 w-20 bg-blue-600 rounded-full flex items-center justify-center mb-6">
                    <i class="fas fa-graduation-cap text-3xl text-white"></i>
                </div>
                <h2 class="text-3xl font-bold text-gray-900">Sistem Absensi Sekolah</h2>
                <p class="mt-2 text-gray-600">Masuk dengan kode unik Anda</p>
            </div>
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <form class="space-y-6" onsubmit="handleLogin(event)">
                    <div>
                        <label for="uniqueCode" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-key mr-2 text-blue-600"></i>Kode Unik
                        </label>
                        <input id="uniqueCode" type="text" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-lg font-mono uppercase" 
                               placeholder="Masukkan kode unik">
                        <div class="mt-3 text-xs text-gray-500 space-y-1">
                            <p><span class="font-semibold text-purple-600">ADM001</span> - Admin</p>
                            <p><span class="font-semibold text-blue-600">GRU001</span> - Guru Matematika</p>
                            <p><span class="font-semibold text-green-600">WAL001</span> - Wali Kelas X-1</p>
                            <p><span class="font-semibold text-yellow-600">KPS001</span> - Kepala Sekolah</p>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">
                        <i class="fas fa-sign-in-alt mr-2"></i>Masuk ke Sistem
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden min-h-full">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="flex justify-between items-center px-6 py-4">
                <div class="flex items-center space-x-4">
                    <div class="h-10 w-10 bg-blue-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-graduation-cap text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-semibold text-gray-900" id="dashboardTitle">Dashboard</h1>
                        <p class="text-sm text-gray-500" id="schoolName">SMA Negeri 1 Jakarta</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <p class="text-sm font-medium text-gray-900" id="currentUser">User</p>
                        <p class="text-xs text-gray-500" id="currentRole">Role</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="text-xs bg-blue-100 text-blue-800 px-3 py-1 rounded-full font-mono" id="userCode">CODE</span>
                        <button onclick="logout()" class="text-red-600 hover:text-red-800 p-2 rounded-full hover:bg-red-50">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="flex h-full">
            <!-- Sidebar -->
            <nav class="bg-gray-900 text-white w-64 min-h-screen">
                <div class="p-4">
                    <ul class="space-y-2" id="sidebarMenu">
                        <!-- Menu items will be populated by JavaScript -->
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="flex-1 p-6 overflow-auto bg-gray-50">
                <div id="mainContent" class="fade-in">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </main>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notifications" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Modal Container -->
    <div id="modalContainer" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-6xl w-full max-h-full overflow-auto">
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // Database dengan sistem kode unik dan auto-save
        let database = {
            users: [
                { 
                    id: 1, 
                    uniqueCode: 'ADM001', 
                    type: 'admin', 
                    name: 'Administrator Sistem', 
                    active: true,
                    createdAt: '2024-01-01'
                },
                { 
                    id: 2, 
                    uniqueCode: 'GRU001', 
                    type: 'guru', 
                    name: 'Budi Santoso', 
                    subject: 'Matematika', 
                    active: true,
                    createdAt: '2024-01-01'
                },
                { 
                    id: 3, 
                    uniqueCode: 'GRU002', 
                    type: 'guru', 
                    name: 'Siti Rahayu', 
                    subject: 'Bahasa Indonesia', 
                    active: true,
                    createdAt: '2024-01-01'
                },
                { 
                    id: 4, 
                    uniqueCode: 'WAL001', 
                    type: 'wali', 
                    name: 'Ahmad Fauzi', 
                    class: 'X-1', 
                    active: true,
                    createdAt: '2024-01-01'
                },
                { 
                    id: 5, 
                    uniqueCode: 'WAL002', 
                    type: 'wali', 
                    name: 'Siti Aminah', 
                    class: 'X-2', 
                    active: true,
                    createdAt: '2024-01-01'
                },
                { 
                    id: 6, 
                    uniqueCode: 'KPS001', 
                    type: 'kepala', 
                    name: 'Dr. Ahmad Wijaya', 
                    active: true,
                    createdAt: '2024-01-01'
                }
            ],
            students: [
                { id: 1, name: 'Andi Pratama', nisn: '1234567890', class: 'X-1', phone: '081234567890' },
                { id: 2, name: 'Sari Dewi', nisn: '1234567891', class: 'X-1', phone: '081234567891' },
                { id: 3, name: 'Budi Setiawan', nisn: '1234567892', class: 'X-2', phone: '081234567892' },
                { id: 4, name: 'Maya Sari', nisn: '1234567893', class: 'XI-1', phone: '081234567893' },
                { id: 5, name: 'Rizki Pratama', nisn: '1234567894', class: 'X-1', phone: '081234567894' },
                { id: 6, name: 'Dewi Lestari', nisn: '1234567895', class: 'X-2', phone: '081234567895' }
            ],
            teachers: [
                { id: 1, name: 'Budi Santoso', subject: 'Matematika', phone: '081234567896', uniqueCode: 'GRU001' },
                { id: 2, name: 'Siti Rahayu', subject: 'Bahasa Indonesia', phone: '081234567897', uniqueCode: 'GRU002' },
                { id: 3, name: 'Ahmad Fauzi', subject: 'Fisika', phone: '081234567898', uniqueCode: 'GRU003' }
            ],
            attendance: [
                { 
                    id: 1, 
                    studentId: 1, 
                    teacherId: 1, 
                    date: '2024-01-15', 
                    time: '08:30:00',
                    status: 'hadir', 
                    subject: 'Matematika', 
                    class: 'X-1', 
                    location: 'Ruang Kelas X-1, Lantai 2',
                    material: 'Persamaan Linear Satu Variabel - Pengenalan konsep dasar dan contoh soal'
                },
                { 
                    id: 2, 
                    studentId: 2, 
                    teacherId: 1, 
                    date: '2024-01-15', 
                    time: '08:30:00',
                    status: 'alpha', 
                    subject: 'Matematika', 
                    class: 'X-1', 
                    location: 'Ruang Kelas X-1, Lantai 2',
                    material: 'Persamaan Linear Satu Variabel - Pengenalan konsep dasar dan contoh soal'
                },
                { 
                    id: 3, 
                    studentId: 1, 
                    teacherId: 2, 
                    date: '2024-01-16', 
                    time: '10:00:00',
                    status: 'sakit', 
                    subject: 'Bahasa Indonesia', 
                    class: 'X-1', 
                    location: 'Ruang Kelas X-1, Lantai 2',
                    material: 'Teks Eksposisi - Struktur dan ciri-ciri teks eksposisi'
                }
            ],
            teacherAttendance: [
                {
                    id: 1,
                    teacherId: 1,
                    date: '2024-01-15',
                    time: '08:25:00',
                    location: 'Ruang Kelas X-1, Lantai 2',
                    coordinates: '-6.200000, 106.816666',
                    subject: 'Matematika',
                    class: 'X-1',
                    material: 'Persamaan Linear Satu Variabel - Pengenalan konsep dasar dan contoh soal'
                },
                {
                    id: 2,
                    teacherId: 2,
                    date: '2024-01-16',
                    time: '10:00:00',
                    location: 'Ruang Kelas X-1, Lantai 2',
                    coordinates: '-6.200000, 106.816666',
                    subject: 'Bahasa Indonesia',
                    class: 'X-1',
                    material: 'Teks Eksposisi - Struktur dan ciri-ciri teks eksposisi'
                }
            ]
        };

        let currentUser = null;

        // Database Auto-Save System
        function saveToLocalStorage() {
            try {
                localStorage.setItem('attendanceSystemDB', JSON.stringify(database));
                console.log('Database saved to localStorage');
            } catch (error) {
                console.error('Error saving to localStorage:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('attendanceSystemDB');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    // Merge with default data to ensure all required fields exist
                    database = { ...database, ...parsedData };
                    console.log('Database loaded from localStorage');
                    return true;
                }
            } catch (error) {
                console.error('Error loading from localStorage:', error);
            }
            return false;
        }

        // Auto-save whenever database changes
        function updateDatabase(callback) {
            if (typeof callback === 'function') {
                callback();
            }
            saveToLocalStorage();
        }

        // Generate unique ID for new records
        function generateId(tableName) {
            const table = database[tableName];
            return table.length > 0 ? Math.max(...table.map(item => item.id)) + 1 : 1;
        }

        // Generate unique code for users
        function generateUniqueCode(type) {
            const prefix = {
                'admin': 'ADM',
                'guru': 'GRU', 
                'wali': 'WAL',
                'kepala': 'KPS'
            };
            
            const existingCodes = database.users
                .filter(u => u.type === type)
                .map(u => parseInt(u.uniqueCode.substring(3)))
                .filter(num => !isNaN(num));
            
            const nextNumber = existingCodes.length > 0 ? Math.max(...existingCodes) + 1 : 1;
            return `${prefix[type]}${nextNumber.toString().padStart(3, '0')}`;
        }

        // Menu configurations for different user types
        const menuConfigs = {
            admin: [
                { id: 'dashboard', icon: 'fas fa-tachometer-alt', text: 'Dashboard', active: true },
                { id: 'users', icon: 'fas fa-users-cog', text: 'Kelola User' },
                { id: 'students', icon: 'fas fa-users', text: 'Kelola Siswa' },
                { id: 'attendance-reports', icon: 'fas fa-clipboard-list', text: 'Laporan Absensi' },
                { id: 'teacher-attendance', icon: 'fas fa-map-marker-alt', text: 'Kehadiran Guru' },
                { id: 'attendance-categories', icon: 'fas fa-exclamation-triangle', text: 'Kategori Kehadiran' },
                { id: 'whatsapp-messages', icon: 'fas fa-comments', text: 'Pesan WhatsApp' }
            ],
            guru: [
                { id: 'dashboard', icon: 'fas fa-tachometer-alt', text: 'Dashboard', active: true },
                { id: 'input-attendance', icon: 'fas fa-camera', text: 'Input Absensi' },
                { id: 'my-attendance-reports', icon: 'fas fa-history', text: 'Rekapan Absensi Saya' },
                { id: 'teacher-attendance', icon: 'fas fa-map-marker-alt', text: 'Kehadiran Guru' }
            ],
            wali: [
                { id: 'dashboard', icon: 'fas fa-tachometer-alt', text: 'Dashboard', active: true },
                { id: 'class-attendance', icon: 'fas fa-eye', text: 'Absensi Kelas' },
                { id: 'teacher-attendance', icon: 'fas fa-map-marker-alt', text: 'Kehadiran Guru' },
                { id: 'class-categories', icon: 'fas fa-exclamation-triangle', text: 'Kategori Kehadiran' },
                { id: 'class-whatsapp', icon: 'fas fa-comments', text: 'Pesan WhatsApp' }
            ],
            kepala: [
                { id: 'dashboard', icon: 'fas fa-tachometer-alt', text: 'Dashboard', active: true },
                { id: 'all-attendance', icon: 'fas fa-users', text: 'Absensi Siswa' },
                { id: 'teacher-summary', icon: 'fas fa-chalkboard-teacher', text: 'Ringkasan Guru' },
                { id: 'teacher-attendance', icon: 'fas fa-map-marker-alt', text: 'Kehadiran Guru' },
                { id: 'school-categories', icon: 'fas fa-exclamation-triangle', text: 'Kategori Kehadiran' },
                { id: 'school-whatsapp', icon: 'fas fa-comments', text: 'Pesan WhatsApp' }
            ]
        };

        // Login handler dengan kode unik
        function handleLogin(event) {
            event.preventDefault();
            const uniqueCode = document.getElementById('uniqueCode').value.toUpperCase().trim();

            if (!uniqueCode) {
                showNotification('Silakan masukkan kode unik!', 'error');
                return;
            }

            const user = database.users.find(u => u.uniqueCode === uniqueCode && u.active);

            if (user) {
                currentUser = user;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                initializeDashboard();
                showNotification(`Selamat datang, ${user.name}!`, 'success');
            } else {
                showNotification('Kode unik tidak valid atau akun tidak aktif!', 'error');
                document.getElementById('uniqueCode').value = '';
                document.getElementById('uniqueCode').focus();
            }
        }

        // Initialize dashboard
        function initializeDashboard() {
            const roleNames = {
                admin: 'Administrator',
                guru: 'Guru',
                wali: 'Wali Kelas',
                kepala: 'Kepala Sekolah'
            };

            document.getElementById('dashboardTitle').textContent = `Dashboard ${roleNames[currentUser.type]}`;
            document.getElementById('currentUser').textContent = currentUser.name;
            document.getElementById('currentRole').textContent = roleNames[currentUser.type];
            document.getElementById('userCode').textContent = currentUser.uniqueCode;
            
            renderSidebar();
            renderDashboard();
        }

        // Render sidebar
        function renderSidebar() {
            const menu = menuConfigs[currentUser.type];
            const sidebarMenu = document.getElementById('sidebarMenu');
            
            sidebarMenu.innerHTML = menu.map(item => `
                <li>
                    <button onclick="navigateTo('${item.id}')" 
                            class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 transition duration-200 ${item.active ? 'bg-gray-800 border-l-4 border-blue-500' : ''}">
                        <i class="${item.icon} mr-3 text-gray-300"></i>
                        <span class="text-gray-100">${item.text}</span>
                    </button>
                </li>
            `).join('');
        }

        // Navigation handler
        function navigateTo(page) {
            // Update active menu
            document.querySelectorAll('#sidebarMenu button').forEach(btn => {
                btn.classList.remove('bg-gray-800', 'border-l-4', 'border-blue-500');
            });
            event.target.closest('button').classList.add('bg-gray-800', 'border-l-4', 'border-blue-500');

            // Render content based on page and user type
            renderContent(page);
        }

        // Render content based on page
        function renderContent(page) {
            switch(page) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'users':
                    renderUsersManagement();
                    break;
                case 'students':
                    renderStudentsManagement();
                    break;
                case 'attendance-reports':
                    renderAttendanceReports();
                    break;
                case 'input-attendance':
                    renderInputAttendance();
                    break;
                case 'my-attendance-reports':
                    renderMyAttendanceReports();
                    break;
                case 'class-attendance':
                    renderClassAttendance();
                    break;
                case 'all-attendance':
                    renderAllAttendance();
                    break;
                case 'teacher-summary':
                    renderTeacherSummary();
                    break;
                case 'teacher-attendance':
                    renderTeacherAttendance();
                    break;
                case 'attendance-categories':
                    renderAttendanceCategories();
                    break;
                case 'whatsapp-messages':
                    renderWhatsAppMessages();
                    break;
                case 'class-categories':
                    renderClassCategories();
                    break;
                case 'class-whatsapp':
                    renderClassWhatsApp();
                    break;
                case 'school-categories':
                    renderSchoolCategories();
                    break;
                case 'school-whatsapp':
                    renderSchoolWhatsApp();
                    break;
                default:
                    renderDashboard();
            }
        }

        // Dashboard renderers for different user types
        function renderDashboard() {
            const mainContent = document.getElementById('mainContent');
            
            switch(currentUser.type) {
                case 'admin':
                    mainContent.innerHTML = renderAdminDashboard();
                    break;
                case 'guru':
                    mainContent.innerHTML = renderGuruDashboard();
                    break;
                case 'wali':
                    mainContent.innerHTML = renderWaliDashboard();
                    break;
                case 'kepala':
                    mainContent.innerHTML = renderKepalaDashboard();
                    break;
            }
        }

        function renderAdminDashboard() {
            const totalStudents = database.students.length;
            const totalTeachers = database.teachers.length;
            const totalUsers = database.users.length;
            const todayAttendance = database.attendance.filter(a => a.date === new Date().toISOString().split('T')[0]).length;
            
            // Attendance statistics
            const totalAttendance = database.attendance.length;
            const presentCount = database.attendance.filter(a => a.status === 'hadir').length;
            const absentCount = database.attendance.filter(a => a.status === 'alpha').length;
            const sickCount = database.attendance.filter(a => a.status === 'sakit').length;
            const permitCount = database.attendance.filter(a => a.status === 'izin').length;
            
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-3xl font-bold text-gray-900">Dashboard Administrator</h2>
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-calendar mr-1"></i>
                            ${new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                        </div>
                    </div>
                    
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                    <i class="fas fa-users text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Siswa</p>
                                    <p class="text-2xl font-bold text-gray-900">${totalStudents}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-green-100 text-green-600">
                                    <i class="fas fa-chalkboard-teacher text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Guru</p>
                                    <p class="text-2xl font-bold text-gray-900">${totalTeachers}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                                    <i class="fas fa-users-cog text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total User</p>
                                    <p class="text-2xl font-bold text-gray-900">${totalUsers}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                                    <i class="fas fa-clipboard-check text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Absensi Hari Ini</p>
                                    <p class="text-2xl font-bold text-gray-900">${todayAttendance}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Aksi Cepat</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="navigateTo('users')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition duration-200 group">
                                <i class="fas fa-users-cog text-2xl text-gray-400 group-hover:text-blue-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-600 group-hover:text-blue-600">Kelola User</p>
                            </button>
                            <button onclick="navigateTo('students')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition duration-200 group">
                                <i class="fas fa-user-plus text-2xl text-gray-400 group-hover:text-green-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-600 group-hover:text-green-600">Kelola Siswa</p>
                            </button>
                            <button onclick="navigateTo('attendance-reports')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-yellow-500 hover:bg-yellow-50 transition duration-200 group">
                                <i class="fas fa-clipboard-list text-2xl text-gray-400 group-hover:text-yellow-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-600 group-hover:text-yellow-600">Laporan Absensi</p>
                            </button>
                            <button onclick="navigateTo('teacher-locations')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition duration-200 group">
                                <i class="fas fa-map-marker-alt text-2xl text-gray-400 group-hover:text-purple-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-600 group-hover:text-purple-600">Lokasi Guru</p>
                            </button>
                        </div>
                    </div>

                    <!-- Attendance Categories -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Kategori Absensi Siswa</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center p-4 bg-green-50 rounded-lg border border-green-200">
                                <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-check text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-green-600">${presentCount}</p>
                                <p class="text-sm text-green-700">Hadir</p>
                                <p class="text-xs text-green-600">${totalAttendance > 0 ? ((presentCount/totalAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                            <div class="text-center p-4 bg-red-50 rounded-lg border border-red-200">
                                <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-times text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-red-600">${absentCount}</p>
                                <p class="text-sm text-red-700">Alpha</p>
                                <p class="text-xs text-red-600">${totalAttendance > 0 ? ((absentCount/totalAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                            <div class="text-center p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                                <div class="w-12 h-12 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-thermometer-half text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-yellow-600">${sickCount}</p>
                                <p class="text-sm text-yellow-700">Sakit</p>
                                <p class="text-xs text-yellow-600">${totalAttendance > 0 ? ((sickCount/totalAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                            <div class="text-center p-4 bg-blue-50 rounded-lg border border-blue-200">
                                <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-hand-paper text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-blue-600">${permitCount}</p>
                                <p class="text-sm text-blue-700">Izin</p>
                                <p class="text-xs text-blue-600">${totalAttendance > 0 ? ((permitCount/totalAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Aktivitas Terbaru</h3>
                        <div class="space-y-3">
                            ${database.attendance.slice(-5).reverse().map(att => {
                                const student = database.students.find(s => s.id === att.studentId);
                                const teacher = database.teachers.find(t => t.id === att.teacherId);
                                return `
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-3 h-3 rounded-full ${att.status === 'hadir' ? 'bg-green-500' : att.status === 'alpha' ? 'bg-red-500' : 'bg-yellow-500'}"></div>
                                            <span class="text-sm font-medium">${student?.name}</span>
                                            <span class="text-sm text-gray-500">- ${att.subject} (${att.status})</span>
                                        </div>
                                        <span class="text-xs text-gray-500">${att.date} ${att.time}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAttendanceReports() {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-900">Laporan Absensi Siswa</h2>

                    <!-- Filters -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Filter Laporan</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label for="filterName" class="block text-sm font-medium text-gray-700 mb-2">Nama Siswa</label>
                                <input type="text" id="filterName" placeholder="Cari nama siswa..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="filterNISN" class="block text-sm font-medium text-gray-700 mb-2">NISN</label>
                                <input type="text" id="filterNISN" placeholder="Cari NISN..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="filterClass" class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                                <select id="filterClass" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Semua Kelas</option>
                                    <option value="X-1">X-1</option>
                                    <option value="X-2">X-2</option>
                                    <option value="XI-1">XI-1</option>
                                    <option value="XI-2">XI-2</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label for="filterSubject" class="block text-sm font-medium text-gray-700 mb-2">Mata Pelajaran</label>
                                <select id="filterSubject" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Semua Mata Pelajaran</option>
                                    <option value="Matematika">Matematika</option>
                                    <option value="Bahasa Indonesia">Bahasa Indonesia</option>
                                    <option value="Fisika">Fisika</option>
                                </select>
                            </div>
                            <div>
                                <label for="filterDateFrom" class="block text-sm font-medium text-gray-700 mb-2">Dari Tanggal</label>
                                <input type="date" id="filterDateFrom" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="filterDateTo" class="block text-sm font-medium text-gray-700 mb-2">Sampai Tanggal</label>
                                <input type="date" id="filterDateTo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="flex items-end">
                                <button onclick="filterAttendanceReports()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                                    <i class="fas fa-search mr-2"></i>Filter
                                </button>
                            </div>
                        </div>
                        <div class="mt-4 flex space-x-2">
                            <button onclick="exportAttendanceToExcel()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200">
                                <i class="fas fa-file-excel mr-2"></i>Export Excel
                            </button>
                            <button onclick="resetAttendanceFilters()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-200">
                                <i class="fas fa-refresh mr-2"></i>Reset Filter
                            </button>
                            <button onclick="showBulkDeleteAttendance()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition duration-200">
                                <i class="fas fa-trash mr-2"></i>Hapus Massal
                            </button>
                        </div>
                    </div>

                    <!-- Results Table -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900">Hasil Laporan</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            <input type="checkbox" id="selectAllAttendance" onchange="toggleAllAttendanceSelection()" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Waktu</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Siswa</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NISN</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kelas</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mata Pelajaran</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lokasi</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="attendanceReportsTableBody" class="bg-white divide-y divide-gray-200">
                                    ${database.attendance.map(att => {
                                        const student = database.students.find(s => s.id === att.studentId);
                                        return `
                                            <tr class="hover:bg-gray-50">
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <input type="checkbox" class="attendance-checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500" value="${att.id}">
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${att.date}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${att.time}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student?.name}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student?.nisn}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${att.class}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${att.subject}</td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2 py-1 text-xs rounded-full ${
                                                        att.status === 'hadir' ? 'bg-green-100 text-green-800' :
                                                        att.status === 'alpha' ? 'bg-red-100 text-red-800' :
                                                        'bg-yellow-100 text-yellow-800'
                                                    }">${att.status}</span>
                                                </td>
                                                <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">${att.location}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                                    <button onclick="editAttendance(${att.id})" class="text-blue-600 hover:text-blue-900">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button onclick="deleteAttendance(${att.id})" class="text-red-600 hover:text-red-900">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        // Utility Functions
        function showNotification(message, type = 'info') {
            const notifications = document.getElementById('notifications');
            const notification = document.createElement('div');
            notification.className = `notification p-4 rounded-lg shadow-lg text-white ${
                type === 'success' ? 'bg-green-600' : 
                type === 'error' ? 'bg-red-600' : 
                type === 'warning' ? 'bg-yellow-600' : 'bg-blue-600'
            }`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-2"></i>
                        <span>${message}</span>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            notifications.appendChild(notification);

            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        function logout() {
            currentUser = null;
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('uniqueCode').value = '';
            document.getElementById('uniqueCode').focus();
            showNotification('Anda telah keluar dari sistem!', 'success');
        }

        // Placeholder functions for other features
        function renderUsersManagement() {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-gray-900">Kelola User Sistem</h2>
                        <button onclick="showAddUserModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                            <i class="fas fa-plus mr-2"></i>Tambah User Baru
                        </button>
                    </div>

                    <!-- User Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="bg-white p-4 rounded-lg shadow-sm border">
                            <div class="flex items-center">
                                <div class="p-2 bg-purple-100 rounded-lg">
                                    <i class="fas fa-users-cog text-purple-600"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-gray-600">Admin</p>
                                    <p class="text-xl font-bold">${database.users.filter(u => u.type === 'admin').length}</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-sm border">
                            <div class="flex items-center">
                                <div class="p-2 bg-blue-100 rounded-lg">
                                    <i class="fas fa-chalkboard-teacher text-blue-600"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-gray-600">Guru</p>
                                    <p class="text-xl font-bold">${database.users.filter(u => u.type === 'guru').length}</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-sm border">
                            <div class="flex items-center">
                                <div class="p-2 bg-green-100 rounded-lg">
                                    <i class="fas fa-users text-green-600"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-gray-600">Wali Kelas</p>
                                    <p class="text-xl font-bold">${database.users.filter(u => u.type === 'wali').length}</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-sm border">
                            <div class="flex items-center">
                                <div class="p-2 bg-yellow-100 rounded-lg">
                                    <i class="fas fa-crown text-yellow-600"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-gray-600">Kepala Sekolah</p>
                                    <p class="text-xl font-bold">${database.users.filter(u => u.type === 'kepala').length}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Users Table -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900">Daftar User</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode Unik</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipe</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Detail</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Dibuat</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${database.users.map(user => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="font-mono text-sm font-medium text-gray-900 bg-gray-100 px-2 py-1 rounded">${user.uniqueCode}</span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${user.name}</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs rounded-full ${
                                                    user.type === 'admin' ? 'bg-purple-100 text-purple-800' :
                                                    user.type === 'guru' ? 'bg-blue-100 text-blue-800' :
                                                    user.type === 'wali' ? 'bg-green-100 text-green-800' :
                                                    'bg-yellow-100 text-yellow-800'
                                                }">
                                                    ${user.type === 'admin' ? 'Administrator' :
                                                      user.type === 'guru' ? 'Guru' :
                                                      user.type === 'wali' ? 'Wali Kelas' :
                                                      'Kepala Sekolah'}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                ${user.subject ? `Mapel: ${user.subject}` : 
                                                  user.class ? `Kelas: ${user.class}` : '-'}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <button onclick="toggleUserStatus(${user.id})" class="px-2 py-1 text-xs rounded-full ${
                                                    user.active ? 'bg-green-100 text-green-800 hover:bg-green-200' : 'bg-red-100 text-red-800 hover:bg-red-200'
                                                } transition duration-200">
                                                    ${user.active ? 'Aktif' : 'Nonaktif'}
                                                </button>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.createdAt}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                                <button onclick="editUser(${user.id})" class="text-blue-600 hover:text-blue-900">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button onclick="deleteUser(${user.id})" class="text-red-600 hover:text-red-900">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderStudentsManagement() {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-gray-900">Kelola Data Siswa</h2>
                        <button onclick="showAddStudentModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                            <i class="fas fa-plus mr-2"></i>Tambah Siswa Baru
                        </button>
                    </div>

                    <!-- Student Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="bg-white p-4 rounded-lg shadow-sm border">
                            <div class="flex items-center">
                                <div class="p-2 bg-blue-100 rounded-lg">
                                    <i class="fas fa-users text-blue-600"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-gray-600">Total Siswa</p>
                                    <p class="text-xl font-bold">${database.students.length}</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-sm border">
                            <div class="flex items-center">
                                <div class="p-2 bg-green-100 rounded-lg">
                                    <i class="fas fa-graduation-cap text-green-600"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-gray-600">Kelas X</p>
                                    <p class="text-xl font-bold">${database.students.filter(s => s.class.startsWith('X')).length}</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-sm border">
                            <div class="flex items-center">
                                <div class="p-2 bg-yellow-100 rounded-lg">
                                    <i class="fas fa-graduation-cap text-yellow-600"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-gray-600">Kelas XI</p>
                                    <p class="text-xl font-bold">${database.students.filter(s => s.class.startsWith('XI')).length}</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-sm border">
                            <div class="flex items-center">
                                <div class="p-2 bg-purple-100 rounded-lg">
                                    <i class="fas fa-graduation-cap text-purple-600"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-gray-600">Kelas XII</p>
                                    <p class="text-xl font-bold">${database.students.filter(s => s.class.startsWith('XII')).length}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Students Table -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900">Daftar Siswa</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NISN</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Siswa</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kelas</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No. Telepon</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${database.students.map(student => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="font-mono text-sm font-medium text-gray-900">${student.nisn}</span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student.name}</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">${student.class}</span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.phone}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                                <button onclick="editStudent(${student.id})" class="text-blue-600 hover:text-blue-900">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button onclick="deleteStudent(${student.id})" class="text-red-600 hover:text-red-900">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTeacherAttendance() {
            const mainContent = document.getElementById('mainContent');
            const pageTitle = currentUser.type === 'admin' ? 'Kehadiran Guru (Admin)' : 
                             currentUser.type === 'kepala' ? 'Kehadiran Guru (Kepala Sekolah)' :
                             currentUser.type === 'wali' ? 'Kehadiran Guru (Wali Kelas)' : 'Kehadiran Guru';
            
            mainContent.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-900">${pageTitle}</h2>

                    <!-- Filters -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Filter Kehadiran Guru</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label for="teacherFilterName" class="block text-sm font-medium text-gray-700 mb-2">Nama Guru</label>
                                <select id="teacherFilterName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Semua Guru</option>
                                    ${database.teachers.map(t => `<option value="${t.name}">${t.name}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label for="teacherFilterDateFrom" class="block text-sm font-medium text-gray-700 mb-2">Dari Tanggal</label>
                                <input type="date" id="teacherFilterDateFrom" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="teacherFilterDateTo" class="block text-sm font-medium text-gray-700 mb-2">Sampai Tanggal</label>
                                <input type="date" id="teacherFilterDateTo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="filterTeacherAttendance()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                                <i class="fas fa-search mr-2"></i>Filter
                            </button>
                            <button onclick="resetTeacherFilters()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-200">
                                <i class="fas fa-refresh mr-2"></i>Reset
                            </button>
                            <button onclick="showBulkDeleteTeacherAttendance()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition duration-200">
                                <i class="fas fa-trash mr-2"></i>Hapus Massal
                            </button>
                        </div>
                    </div>

                    <!-- Results Table -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900">Data Kehadiran Guru</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            <input type="checkbox" id="selectAllTeacherAttendance" onchange="toggleAllTeacherAttendanceSelection()" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Waktu</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Guru</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mata Pelajaran</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kelas</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lokasi</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Koordinat</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Materi</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="teacherAttendanceTableBody" class="bg-white divide-y divide-gray-200">
                                    ${database.teacherAttendance.map(ta => {
                                        const teacher = database.teachers.find(t => t.id === ta.teacherId);
                                        return `
                                            <tr class="hover:bg-gray-50">
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <input type="checkbox" class="teacher-attendance-checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500" value="${ta.id}">
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${ta.date}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ta.time}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${teacher?.name}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ta.subject}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ta.class}</td>
                                                <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">${ta.location}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ta.coordinates}</td>
                                                <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">${ta.material}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                                    <button onclick="viewLocationOnMap('${ta.coordinates}')" class="text-blue-600 hover:text-blue-900" title="Lihat Lokasi">
                                                        <i class="fas fa-map-marker-alt"></i>
                                                    </button>
                                                    <button onclick="editTeacherLocation(${ta.id})" class="text-green-600 hover:text-green-900" title="Edit Lokasi">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button onclick="deleteTeacherAttendance(${ta.id})" class="text-red-600 hover:text-red-900" title="Hapus Data">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderInputAttendance() {
            const mainContent = document.getElementById('mainContent');
            const currentTeacher = database.teachers.find(t => t.uniqueCode === currentUser.uniqueCode);
            
            mainContent.innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-gray-900">Input Absensi Siswa</h2>
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-user-tie mr-1"></i>
                            ${currentUser.name} - ${currentUser.subject}
                        </div>
                    </div>

                    <!-- Teacher Check-in -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Absensi Guru</h3>
                        <form onsubmit="teacherCheckIn(event)" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="teacherClass" class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                                    <select id="teacherClass" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">Pilih Kelas</option>
                                        <option value="X-1">X-1</option>
                                        <option value="X-2">X-2</option>
                                        <option value="XI-1">XI-1</option>
                                        <option value="XI-2">XI-2</option>
                                        <option value="XII-1">XII-1</option>
                                        <option value="XII-2">XII-2</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="teacherLocation" class="block text-sm font-medium text-gray-700 mb-2">Lokasi</label>
                                    <div class="flex space-x-2">
                                        <input type="text" id="teacherLocation" readonly class="flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-600" placeholder="Mendeteksi lokasi...">
                                        <button type="button" onclick="getLocation()" class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                            <i class="fas fa-location-arrow"></i>
                                        </button>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Lokasi akan terdeteksi otomatis</p>
                                </div>
                            </div>
                            <div>
                                <label for="teacherMaterial" class="block text-sm font-medium text-gray-700 mb-2">Materi Pembelajaran</label>
                                <textarea id="teacherMaterial" required rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Deskripsi materi yang akan diajarkan..."></textarea>
                            </div>
                            <button type="submit" id="checkinButton" disabled class="bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed">
                                <i class="fas fa-map-marker-alt mr-2"></i>Check-in Guru (Menunggu Lokasi)
                            </button>
                        </form>
                    </div>

                    <!-- Student Attendance Form -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Input Absensi Siswa</h3>
                        <form onsubmit="inputStudentAttendance(event)" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label for="studentClass" class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                                    <select id="studentClass" required onchange="loadStudentsByClass()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">Pilih Kelas</option>
                                        <option value="X-1">X-1</option>
                                        <option value="X-2">X-2</option>
                                        <option value="XI-1">XI-1</option>
                                        <option value="XI-2">XI-2</option>
                                        <option value="XII-1">XII-1</option>
                                        <option value="XII-2">XII-2</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="attendanceDate" class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                                    <input type="date" id="attendanceDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" value="${new Date().toISOString().split('T')[0]}">
                                </div>
                                <div>
                                    <label for="attendanceTime" class="block text-sm font-medium text-gray-700 mb-2">Waktu</label>
                                    <input type="time" id="attendanceTime" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" value="${new Date().toTimeString().slice(0,5)}">
                                </div>
                            </div>
                            
                            <div>
                                <label for="lessonMaterial" class="block text-sm font-medium text-gray-700 mb-2">Materi Pelajaran</label>
                                <textarea id="lessonMaterial" required rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Deskripsi materi yang diajarkan..."></textarea>
                            </div>

                            <div id="studentsAttendanceList" class="space-y-3">
                                <p class="text-gray-500 text-center py-4">Pilih kelas untuk menampilkan daftar siswa</p>
                            </div>

                            <div class="flex justify-end space-x-3">
                                <button type="button" onclick="markAllPresent()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200">
                                    <i class="fas fa-check-double mr-2"></i>Tandai Semua Hadir
                                </button>
                                <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                                    <i class="fas fa-save mr-2"></i>Simpan Absensi
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        function renderMyAttendanceReports() {
            const mainContent = document.getElementById('mainContent');
            const currentTeacher = database.teachers.find(t => t.uniqueCode === currentUser.uniqueCode);
            
            mainContent.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-900">Rekapan Absensi Saya</h2>

                    <!-- Filters -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Filter Laporan</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label for="myFilterName" class="block text-sm font-medium text-gray-700 mb-2">Nama Siswa</label>
                                <input type="text" id="myFilterName" placeholder="Cari nama siswa..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="myFilterNISN" class="block text-sm font-medium text-gray-700 mb-2">NISN</label>
                                <input type="text" id="myFilterNISN" placeholder="Cari NISN..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="myFilterClass" class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                                <select id="myFilterClass" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Semua Kelas</option>
                                    <option value="X-1">X-1</option>
                                    <option value="X-2">X-2</option>
                                    <option value="XI-1">XI-1</option>
                                    <option value="XI-2">XI-2</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="myFilterDateFrom" class="block text-sm font-medium text-gray-700 mb-2">Dari Tanggal</label>
                                <input type="date" id="myFilterDateFrom" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="myFilterDateTo" class="block text-sm font-medium text-gray-700 mb-2">Sampai Tanggal</label>
                                <input type="date" id="myFilterDateTo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="filterMyAttendanceReports()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                                <i class="fas fa-search mr-2"></i>Filter
                            </button>
                            <button onclick="resetMyFilters()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-200">
                                <i class="fas fa-refresh mr-2"></i>Reset
                            </button>
                        </div>
                    </div>

                    <!-- Results Table -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900">Data Absensi yang Saya Input</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Waktu</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Siswa</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NISN</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kelas</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Materi</th>
                                    </tr>
                                </thead>
                                <tbody id="myAttendanceReportsTableBody" class="bg-white divide-y divide-gray-200">
                                    ${database.attendance.filter(att => att.teacherId === currentTeacher?.id).map(att => {
                                        const student = database.students.find(s => s.id === att.studentId);
                                        return `
                                            <tr class="hover:bg-gray-50">
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${att.date}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${att.time}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student?.name}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student?.nisn}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${att.class}</td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2 py-1 text-xs rounded-full ${
                                                        att.status === 'hadir' ? 'bg-green-100 text-green-800' :
                                                        att.status === 'alpha' ? 'bg-red-100 text-red-800' :
                                                        'bg-yellow-100 text-yellow-800'
                                                    }">${att.status}</span>
                                                </td>
                                                <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">${att.material || '-'}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderClassAttendance() {
            const mainContent = document.getElementById('mainContent');
            
            mainContent.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-900">Absensi Kelas ${currentUser.class}</h2>

                    <!-- Filters -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Filter Absensi</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label for="classFilterName" class="block text-sm font-medium text-gray-700 mb-2">Nama Siswa</label>
                                <input type="text" id="classFilterName" placeholder="Cari nama siswa..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="classFilterNISN" class="block text-sm font-medium text-gray-700 mb-2">NISN</label>
                                <input type="text" id="classFilterNISN" placeholder="Cari NISN..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="classFilterSubject" class="block text-sm font-medium text-gray-700 mb-2">Mata Pelajaran</label>
                                <select id="classFilterSubject" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Semua Mata Pelajaran</option>
                                    <option value="Matematika">Matematika</option>
                                    <option value="Bahasa Indonesia">Bahasa Indonesia</option>
                                    <option value="Fisika">Fisika</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="classFilterDateFrom" class="block text-sm font-medium text-gray-700 mb-2">Dari Tanggal</label>
                                <input type="date" id="classFilterDateFrom" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="classFilterDateTo" class="block text-sm font-medium text-gray-700 mb-2">Sampai Tanggal</label>
                                <input type="date" id="classFilterDateTo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="filterClassAttendance()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                                <i class="fas fa-search mr-2"></i>Filter
                            </button>
                            <button onclick="resetClassFilters()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-200">
                                <i class="fas fa-refresh mr-2"></i>Reset
                            </button>
                        </div>
                    </div>

                    <!-- Results Table -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900">Data Absensi Kelas ${currentUser.class}</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Siswa</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NISN</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mata Pelajaran</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Guru</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Materi</th>
                                    </tr>
                                </thead>
                                <tbody id="classAttendanceTableBody" class="bg-white divide-y divide-gray-200">
                                    ${database.attendance.filter(att => att.class === currentUser.class).map(att => {
                                        const student = database.students.find(s => s.id === att.studentId);
                                        const teacher = database.teachers.find(t => t.id === att.teacherId);
                                        return `
                                            <tr class="hover:bg-gray-50">
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${att.date}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student?.name}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student?.nisn}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${att.subject}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${teacher?.name}</td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2 py-1 text-xs rounded-full ${
                                                        att.status === 'hadir' ? 'bg-green-100 text-green-800' :
                                                        att.status === 'alpha' ? 'bg-red-100 text-red-800' :
                                                        'bg-yellow-100 text-yellow-800'
                                                    }">${att.status}</span>
                                                </td>
                                                <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">${att.material || '-'}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAllAttendance() {
            const mainContent = document.getElementById('mainContent');
            
            mainContent.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-900">Absensi Siswa (Kepala Sekolah)</h2>

                    <!-- Filters -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Filter Absensi</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label for="allFilterName" class="block text-sm font-medium text-gray-700 mb-2">Nama Siswa</label>
                                <input type="text" id="allFilterName" placeholder="Cari nama siswa..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="allFilterNISN" class="block text-sm font-medium text-gray-700 mb-2">NISN</label>
                                <input type="text" id="allFilterNISN" placeholder="Cari NISN..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="allFilterClass" class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                                <select id="allFilterClass" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Semua Kelas</option>
                                    <option value="X-1">X-1</option>
                                    <option value="X-2">X-2</option>
                                    <option value="XI-1">XI-1</option>
                                    <option value="XI-2">XI-2</option>
                                </select>
                            </div>
                            <div>
                                <label for="allFilterSubject" class="block text-sm font-medium text-gray-700 mb-2">Mata Pelajaran</label>
                                <select id="allFilterSubject" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Semua Mata Pelajaran</option>
                                    <option value="Matematika">Matematika</option>
                                    <option value="Bahasa Indonesia">Bahasa Indonesia</option>
                                    <option value="Fisika">Fisika</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="allFilterDateFrom" class="block text-sm font-medium text-gray-700 mb-2">Dari Tanggal</label>
                                <input type="date" id="allFilterDateFrom" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="allFilterDateTo" class="block text-sm font-medium text-gray-700 mb-2">Sampai Tanggal</label>
                                <input type="date" id="allFilterDateTo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="filterAllAttendance()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                                <i class="fas fa-search mr-2"></i>Filter
                            </button>
                            <button onclick="resetAllFilters()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-200">
                                <i class="fas fa-refresh mr-2"></i>Reset
                            </button>
                        </div>
                    </div>

                    <!-- Results Table -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900">Data Absensi Seluruh Siswa</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Siswa</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NISN</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kelas</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mata Pelajaran</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Guru</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Materi</th>
                                    </tr>
                                </thead>
                                <tbody id="allAttendanceTableBody" class="bg-white divide-y divide-gray-200">
                                    ${database.attendance.map(att => {
                                        const student = database.students.find(s => s.id === att.studentId);
                                        const teacher = database.teachers.find(t => t.id === att.teacherId);
                                        return `
                                            <tr class="hover:bg-gray-50">
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${att.date}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student?.name}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student?.nisn}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${att.class}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${att.subject}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${teacher?.name}</td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2 py-1 text-xs rounded-full ${
                                                        att.status === 'hadir' ? 'bg-green-100 text-green-800' :
                                                        att.status === 'alpha' ? 'bg-red-100 text-red-800' :
                                                        'bg-yellow-100 text-yellow-800'
                                                    }">${att.status}</span>
                                                </td>
                                                <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">${att.material || '-'}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTeacherSummary() {
            document.getElementById('mainContent').innerHTML = `
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-100 text-center">
                    <i class="fas fa-chalkboard-teacher text-6xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Ringkasan Kehadiran Guru</h3>
                    <p class="text-gray-500">Kepala sekolah dapat melihat ringkasan kehadiran guru hari ini beserta materinya</p>
                </div>
            `;
        }

        function renderTeacherAttendance() {
            document.getElementById('mainContent').innerHTML = `
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-100 text-center">
                    <i class="fas fa-map-marker-alt text-6xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Kehadiran Guru</h3>
                    <p class="text-gray-500">Kepala sekolah dapat melihat kehadiran guru melalui data waktu dilakukannya absensi dan titik lokasi dengan filter nama dan rentang tanggal tertentu</p>
                </div>
            `;
        }

        function renderGuruDashboard() {
            return `
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-100 text-center">
                    <i class="fas fa-chalkboard-teacher text-6xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Dashboard Guru</h3>
                    <p class="text-gray-500">Selamat datang, ${currentUser.name}!</p>
                    <p class="text-gray-400 mt-2">Mata Pelajaran: ${currentUser.subject}</p>
                </div>
            `;
        }

        function renderWaliDashboard() {
            const classAttendance = database.attendance.filter(a => a.class === currentUser.class);
            const presentCount = classAttendance.filter(a => a.status === 'hadir').length;
            const absentCount = classAttendance.filter(a => a.status === 'alpha').length;
            const sickCount = classAttendance.filter(a => a.status === 'sakit').length;
            const permitCount = classAttendance.filter(a => a.status === 'izin').length;
            const totalClassAttendance = classAttendance.length;
            const classStudents = database.students.filter(s => s.class === currentUser.class);
            
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-3xl font-bold text-gray-900">Dashboard Wali Kelas ${currentUser.class}</h2>
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-calendar mr-1"></i>
                            ${new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                        </div>
                    </div>
                    
                    <!-- Class Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                    <i class="fas fa-users text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Siswa Kelas ${currentUser.class}</p>
                                    <p class="text-2xl font-bold text-gray-900">${classStudents.length}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-green-100 text-green-600">
                                    <i class="fas fa-clipboard-check text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Record Absensi</p>
                                    <p class="text-2xl font-bold text-gray-900">${totalClassAttendance}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Attendance Categories for Class -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Kategori Absensi Kelas ${currentUser.class}</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center p-4 bg-green-50 rounded-lg border border-green-200">
                                <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-check text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-green-600">${presentCount}</p>
                                <p class="text-sm text-green-700">Hadir</p>
                                <p class="text-xs text-green-600">${totalClassAttendance > 0 ? ((presentCount/totalClassAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                            <div class="text-center p-4 bg-red-50 rounded-lg border border-red-200">
                                <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-times text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-red-600">${absentCount}</p>
                                <p class="text-sm text-red-700">Alpha</p>
                                <p class="text-xs text-red-600">${totalClassAttendance > 0 ? ((absentCount/totalClassAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                            <div class="text-center p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                                <div class="w-12 h-12 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-thermometer-half text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-yellow-600">${sickCount}</p>
                                <p class="text-sm text-yellow-700">Sakit</p>
                                <p class="text-xs text-yellow-600">${totalClassAttendance > 0 ? ((sickCount/totalClassAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                            <div class="text-center p-4 bg-blue-50 rounded-lg border border-blue-200">
                                <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-hand-paper text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-blue-600">${permitCount}</p>
                                <p class="text-sm text-blue-700">Izin</p>
                                <p class="text-xs text-blue-600">${totalClassAttendance > 0 ? ((permitCount/totalClassAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Aksi Cepat</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="navigateTo('class-attendance')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition duration-200 group">
                                <i class="fas fa-eye text-2xl text-gray-400 group-hover:text-blue-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-600 group-hover:text-blue-600">Lihat Absensi Kelas</p>
                            </button>
                            <div class="p-4 border-2 border-dashed border-gray-200 rounded-lg bg-gray-50">
                                <i class="fas fa-chart-bar text-2xl text-gray-300 mb-2"></i>
                                <p class="text-sm font-medium text-gray-400">Laporan Bulanan</p>
                                <p class="text-xs text-gray-400">Segera hadir</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderKepalaDashboard() {
            const totalStudents = database.students.length;
            const totalTeachers = database.teachers.length;
            const totalAttendance = database.attendance.length;
            const presentCount = database.attendance.filter(a => a.status === 'hadir').length;
            const absentCount = database.attendance.filter(a => a.status === 'alpha').length;
            const sickCount = database.attendance.filter(a => a.status === 'sakit').length;
            const permitCount = database.attendance.filter(a => a.status === 'izin').length;
            const todayAttendance = database.attendance.filter(a => a.date === new Date().toISOString().split('T')[0]).length;
            
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-3xl font-bold text-gray-900">Dashboard Kepala Sekolah</h2>
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-calendar mr-1"></i>
                            ${new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                        </div>
                    </div>
                    
                    <!-- School Overview Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                    <i class="fas fa-users text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Siswa</p>
                                    <p class="text-2xl font-bold text-gray-900">${totalStudents}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-green-100 text-green-600">
                                    <i class="fas fa-chalkboard-teacher text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Guru</p>
                                    <p class="text-2xl font-bold text-gray-900">${totalTeachers}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                                    <i class="fas fa-clipboard-list text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Record Absensi</p>
                                    <p class="text-2xl font-bold text-gray-900">${totalAttendance}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                                    <i class="fas fa-calendar-check text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Absensi Hari Ini</p>
                                    <p class="text-2xl font-bold text-gray-900">${todayAttendance}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Overall Attendance Categories -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Kategori Absensi Keseluruhan Sekolah</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center p-4 bg-green-50 rounded-lg border border-green-200">
                                <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-check text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-green-600">${presentCount}</p>
                                <p class="text-sm text-green-700">Hadir</p>
                                <p class="text-xs text-green-600">${totalAttendance > 0 ? ((presentCount/totalAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                            <div class="text-center p-4 bg-red-50 rounded-lg border border-red-200">
                                <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-times text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-red-600">${absentCount}</p>
                                <p class="text-sm text-red-700">Alpha</p>
                                <p class="text-xs text-red-600">${totalAttendance > 0 ? ((absentCount/totalAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                            <div class="text-center p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                                <div class="w-12 h-12 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-thermometer-half text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-yellow-600">${sickCount}</p>
                                <p class="text-sm text-yellow-700">Sakit</p>
                                <p class="text-xs text-yellow-600">${totalAttendance > 0 ? ((sickCount/totalAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                            <div class="text-center p-4 bg-blue-50 rounded-lg border border-blue-200">
                                <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-hand-paper text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-blue-600">${permitCount}</p>
                                <p class="text-sm text-blue-700">Izin</p>
                                <p class="text-xs text-blue-600">${totalAttendance > 0 ? ((permitCount/totalAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Aksi Cepat</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="navigateTo('all-attendance')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition duration-200 group">
                                <i class="fas fa-users text-2xl text-gray-400 group-hover:text-blue-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-600 group-hover:text-blue-600">Absensi Siswa</p>
                            </button>
                            <button onclick="navigateTo('teacher-summary')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition duration-200 group">
                                <i class="fas fa-chalkboard-teacher text-2xl text-gray-400 group-hover:text-green-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-600 group-hover:text-green-600">Ringkasan Guru</p>
                            </button>
                            <button onclick="navigateTo('teacher-attendance')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition duration-200 group">
                                <i class="fas fa-map-marker-alt text-2xl text-gray-400 group-hover:text-purple-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-600 group-hover:text-purple-600">Kehadiran Guru</p>
                            </button>
                            <div class="p-4 border-2 border-dashed border-gray-200 rounded-lg bg-gray-50">
                                <i class="fas fa-chart-line text-2xl text-gray-300 mb-2"></i>
                                <p class="text-sm font-medium text-gray-400">Analisis Trend</p>
                                <p class="text-xs text-gray-400">Segera hadir</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Placeholder functions for filter operations
        function filterAttendanceReports() {
            showNotification('Filter laporan absensi diterapkan!', 'success');
        }

        function exportAttendanceToExcel() {
            showNotification('Data berhasil diekspor ke Excel!', 'success');
        }

        function resetAttendanceFilters() {
            document.getElementById('filterName').value = '';
            document.getElementById('filterNISN').value = '';
            document.getElementById('filterClass').value = '';
            document.getElementById('filterSubject').value = '';
            document.getElementById('filterDateFrom').value = '';
            document.getElementById('filterDateTo').value = '';
            showNotification('Filter berhasil direset!', 'success');
        }

        function editAttendance(id) {
            showNotification('Fitur edit absensi akan segera tersedia!', 'info');
        }

        function deleteAttendance(id) {
            const attendance = database.attendance.find(a => a.id === id);
            if (!attendance) return;
            
            const student = database.students.find(s => s.id === attendance.studentId);
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-red-600">Konfirmasi Hapus Data Absensi</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>
                                <div>
                                    <h4 class="font-medium text-red-800">Peringatan!</h4>
                                    <p class="text-red-700 text-sm mt-1">Data absensi yang dihapus tidak dapat dikembalikan.</p>
                                </div>
                            </div>
                        </div>
                        
                        <p class="text-gray-700">Apakah Anda yakin ingin menghapus data absensi berikut?</p>
                        <div class="mt-3 p-3 bg-gray-50 rounded-lg">
                            <p class="font-medium">${student?.name}</p>
                            <p class="text-sm text-gray-600">Tanggal: ${attendance.date} ${attendance.time}</p>
                            <p class="text-sm text-gray-600">Mata Pelajaran: ${attendance.subject}</p>
                            <p class="text-sm text-gray-600">Status: ${attendance.status}</p>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Batal
                        </button>
                        <button onclick="confirmDeleteAttendance(${id})" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            <i class="fas fa-trash mr-2"></i>Hapus Data
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        // Additional Filter Functions
        function filterMyAttendanceReports() {
            const currentTeacher = database.teachers.find(t => t.uniqueCode === currentUser.uniqueCode);
            const name = document.getElementById('myFilterName').value.toLowerCase();
            const nisn = document.getElementById('myFilterNISN').value;
            const className = document.getElementById('myFilterClass').value;
            const dateFrom = document.getElementById('myFilterDateFrom').value;
            const dateTo = document.getElementById('myFilterDateTo').value;

            let filteredData = database.attendance.filter(att => {
                const student = database.students.find(s => s.id === att.studentId);
                
                const matchTeacher = att.teacherId === currentTeacher?.id;
                const matchName = !name || student?.name.toLowerCase().includes(name);
                const matchNISN = !nisn || student?.nisn.includes(nisn);
                const matchClass = !className || att.class === className;
                const matchDateFrom = !dateFrom || att.date >= dateFrom;
                const matchDateTo = !dateTo || att.date <= dateTo;

                return matchTeacher && matchName && matchNISN && matchClass && matchDateFrom && matchDateTo;
            });

            updateMyAttendanceTable(filteredData);
            showNotification(`Filter diterapkan. Ditemukan ${filteredData.length} data.`, 'success');
        }

        function resetMyFilters() {
            document.getElementById('myFilterName').value = '';
            document.getElementById('myFilterNISN').value = '';
            document.getElementById('myFilterClass').value = '';
            document.getElementById('myFilterDateFrom').value = '';
            document.getElementById('myFilterDateTo').value = '';
            renderMyAttendanceReports();
            showNotification('Filter berhasil direset!', 'success');
        }

        function resetClassFilters() {
            document.getElementById('classFilterName').value = '';
            document.getElementById('classFilterNISN').value = '';
            document.getElementById('classFilterSubject').value = '';
            document.getElementById('classFilterDateFrom').value = '';
            document.getElementById('classFilterDateTo').value = '';
            renderClassAttendance();
            showNotification('Filter berhasil direset!', 'success');
        }

        function resetAllFilters() {
            document.getElementById('allFilterName').value = '';
            document.getElementById('allFilterNISN').value = '';
            document.getElementById('allFilterClass').value = '';
            document.getElementById('allFilterSubject').value = '';
            document.getElementById('allFilterDateFrom').value = '';
            document.getElementById('allFilterDateTo').value = '';
            renderAllAttendance();
            showNotification('Filter berhasil direset!', 'success');
        }

        function resetTeacherFilters() {
            document.getElementById('teacherFilterName').value = '';
            document.getElementById('teacherFilterDateFrom').value = '';
            document.getElementById('teacherFilterDateTo').value = '';
            renderTeacherAttendance();
            showNotification('Filter berhasil direset!', 'success');
        }

        function viewLocationOnMap(coordinates) {
            const [lat, lon] = coordinates.split(', ');
            const googleMapsUrl = `https://www.google.com/maps?q=${lat},${lon}`;
            window.open(googleMapsUrl, '_blank', 'noopener,noreferrer');
        }

        function filterClassAttendance() {
            const name = document.getElementById('classFilterName').value.toLowerCase();
            const nisn = document.getElementById('classFilterNISN').value;
            const subject = document.getElementById('classFilterSubject').value;
            const dateFrom = document.getElementById('classFilterDateFrom').value;
            const dateTo = document.getElementById('classFilterDateTo').value;

            let filteredData = database.attendance.filter(att => {
                const student = database.students.find(s => s.id === att.studentId);
                
                const matchClass = att.class === currentUser.class;
                const matchName = !name || student?.name.toLowerCase().includes(name);
                const matchNISN = !nisn || student?.nisn.includes(nisn);
                const matchSubject = !subject || att.subject === subject;
                const matchDateFrom = !dateFrom || att.date >= dateFrom;
                const matchDateTo = !dateTo || att.date <= dateTo;

                return matchClass && matchName && matchNISN && matchSubject && matchDateFrom && matchDateTo;
            });

            updateClassAttendanceTable(filteredData);
            showNotification(`Filter diterapkan. Ditemukan ${filteredData.length} data.`, 'success');
        }

        function filterAllAttendance() {
            const name = document.getElementById('allFilterName').value.toLowerCase();
            const nisn = document.getElementById('allFilterNISN').value;
            const className = document.getElementById('allFilterClass').value;
            const subject = document.getElementById('allFilterSubject').value;
            const dateFrom = document.getElementById('allFilterDateFrom').value;
            const dateTo = document.getElementById('allFilterDateTo').value;

            let filteredData = database.attendance.filter(att => {
                const student = database.students.find(s => s.id === att.studentId);
                
                const matchName = !name || student?.name.toLowerCase().includes(name);
                const matchNISN = !nisn || student?.nisn.includes(nisn);
                const matchClass = !className || att.class === className;
                const matchSubject = !subject || att.subject === subject;
                const matchDateFrom = !dateFrom || att.date >= dateFrom;
                const matchDateTo = !dateTo || att.date <= dateTo;

                return matchName && matchNISN && matchClass && matchSubject && matchDateFrom && matchDateTo;
            });

            updateAllAttendanceTable(filteredData);
            showNotification(`Filter diterapkan. Ditemukan ${filteredData.length} data.`, 'success');
        }

        function filterTeacherAttendance() {
            const teacherName = document.getElementById('teacherFilterName').value;
            const dateFrom = document.getElementById('teacherFilterDateFrom').value;
            const dateTo = document.getElementById('teacherFilterDateTo').value;

            let filteredData = database.teacherAttendance.filter(ta => {
                const teacher = database.teachers.find(t => t.id === ta.teacherId);
                
                const matchTeacher = !teacherName || teacher?.name === teacherName;
                const matchDateFrom = !dateFrom || ta.date >= dateFrom;
                const matchDateTo = !dateTo || ta.date <= dateTo;

                return matchTeacher && matchDateFrom && matchDateTo;
            });

            updateTeacherAttendanceTable(filteredData);
            showNotification(`Filter diterapkan. Ditemukan ${filteredData.length} data.`, 'success');
        }

        // Update table functions
        function updateMyAttendanceTable(data) {
            const tableBody = document.getElementById('myAttendanceReportsTableBody');
            tableBody.innerHTML = data.map(att => {
                const student = database.students.find(s => s.id === att.studentId);
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${att.date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${att.time}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student?.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student?.nisn}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${att.class}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs rounded-full ${
                                att.status === 'hadir' ? 'bg-green-100 text-green-800' :
                                att.status === 'alpha' ? 'bg-red-100 text-red-800' :
                                'bg-yellow-100 text-yellow-800'
                            }">${att.status}</span>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">${att.material || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function updateClassAttendanceTable(data) {
            const tableBody = document.getElementById('classAttendanceTableBody');
            tableBody.innerHTML = data.map(att => {
                const student = database.students.find(s => s.id === att.studentId);
                const teacher = database.teachers.find(t => t.id === att.teacherId);
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${att.date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student?.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student?.nisn}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${att.subject}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${teacher?.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs rounded-full ${
                                att.status === 'hadir' ? 'bg-green-100 text-green-800' :
                                att.status === 'alpha' ? 'bg-red-100 text-red-800' :
                                'bg-yellow-100 text-yellow-800'
                            }">${att.status}</span>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">${att.material || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function updateAllAttendanceTable(data) {
            const tableBody = document.getElementById('allAttendanceTableBody');
            tableBody.innerHTML = data.map(att => {
                const student = database.students.find(s => s.id === att.studentId);
                const teacher = database.teachers.find(t => t.id === att.teacherId);
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${att.date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student?.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student?.nisn}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${att.class}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${att.subject}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${teacher?.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs rounded-full ${
                                att.status === 'hadir' ? 'bg-green-100 text-green-800' :
                                att.status === 'alpha' ? 'bg-red-100 text-red-800' :
                                'bg-yellow-100 text-yellow-800'
                            }">${att.status}</span>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">${att.material || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function updateTeacherAttendanceTable(data) {
            const tableBody = document.getElementById('teacherAttendanceTableBody');
            tableBody.innerHTML = data.map(ta => {
                const teacher = database.teachers.find(t => t.id === ta.teacherId);
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <input type="checkbox" class="teacher-attendance-checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500" value="${ta.id}">
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${ta.date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ta.time}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${teacher?.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ta.subject}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ta.class}</td>
                        <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">${ta.location}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ta.coordinates}</td>
                        <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">${ta.material}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                            <button onclick="viewLocationOnMap('${ta.coordinates}')" class="text-blue-600 hover:text-blue-900" title="Lihat Lokasi">
                                <i class="fas fa-map-marker-alt"></i>
                            </button>
                            <button onclick="editTeacherLocation(${ta.id})" class="text-green-600 hover:text-green-900" title="Edit Lokasi">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteTeacherAttendance(${ta.id})" class="text-red-600 hover:text-red-900" title="Hapus Data">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderGuruDashboard() {
            return `
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-100 text-center">
                    <i class="fas fa-chalkboard-teacher text-6xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Dashboard Guru</h3>
                    <p class="text-gray-500">Selamat datang, ${currentUser.name}!</p>
                    <p class="text-gray-400 mt-2">Mata Pelajaran: ${currentUser.subject}</p>
                </div>
            `;
        }

        function renderWaliDashboard() {
            const classAttendance = database.attendance.filter(a => a.class === currentUser.class);
            const presentCount = classAttendance.filter(a => a.status === 'hadir').length;
            const absentCount = classAttendance.filter(a => a.status === 'alpha').length;
            const sickCount = classAttendance.filter(a => a.status === 'sakit').length;
            const permitCount = classAttendance.filter(a => a.status === 'izin').length;
            const totalClassAttendance = classAttendance.length;
            const classStudents = database.students.filter(s => s.class === currentUser.class);
            
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-3xl font-bold text-gray-900">Dashboard Wali Kelas ${currentUser.class}</h2>
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-calendar mr-1"></i>
                            ${new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                        </div>
                    </div>
                    
                    <!-- Class Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                    <i class="fas fa-users text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Siswa Kelas ${currentUser.class}</p>
                                    <p class="text-2xl font-bold text-gray-900">${classStudents.length}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-green-100 text-green-600">
                                    <i class="fas fa-clipboard-check text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Record Absensi</p>
                                    <p class="text-2xl font-bold text-gray-900">${totalClassAttendance}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Attendance Categories for Class -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Kategori Absensi Kelas ${currentUser.class}</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center p-4 bg-green-50 rounded-lg border border-green-200">
                                <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-check text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-green-600">${presentCount}</p>
                                <p class="text-sm text-green-700">Hadir</p>
                                <p class="text-xs text-green-600">${totalClassAttendance > 0 ? ((presentCount/totalClassAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                            <div class="text-center p-4 bg-red-50 rounded-lg border border-red-200">
                                <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-times text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-red-600">${absentCount}</p>
                                <p class="text-sm text-red-700">Alpha</p>
                                <p class="text-xs text-red-600">${totalClassAttendance > 0 ? ((absentCount/totalClassAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                            <div class="text-center p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                                <div class="w-12 h-12 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-thermometer-half text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-yellow-600">${sickCount}</p>
                                <p class="text-sm text-yellow-700">Sakit</p>
                                <p class="text-xs text-yellow-600">${totalClassAttendance > 0 ? ((sickCount/totalClassAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                            <div class="text-center p-4 bg-blue-50 rounded-lg border border-blue-200">
                                <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-hand-paper text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-blue-600">${permitCount}</p>
                                <p class="text-sm text-blue-700">Izin</p>
                                <p class="text-xs text-blue-600">${totalClassAttendance > 0 ? ((permitCount/totalClassAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Aksi Cepat</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="navigateTo('class-attendance')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition duration-200 group">
                                <i class="fas fa-eye text-2xl text-gray-400 group-hover:text-blue-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-600 group-hover:text-blue-600">Lihat Absensi Kelas</p>
                            </button>
                            <div class="p-4 border-2 border-dashed border-gray-200 rounded-lg bg-gray-50">
                                <i class="fas fa-chart-bar text-2xl text-gray-300 mb-2"></i>
                                <p class="text-sm font-medium text-gray-400">Laporan Bulanan</p>
                                <p class="text-xs text-gray-400">Segera hadir</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderKepalaDashboard() {
            const totalStudents = database.students.length;
            const totalTeachers = database.teachers.length;
            const totalAttendance = database.attendance.length;
            const presentCount = database.attendance.filter(a => a.status === 'hadir').length;
            const absentCount = database.attendance.filter(a => a.status === 'alpha').length;
            const sickCount = database.attendance.filter(a => a.status === 'sakit').length;
            const permitCount = database.attendance.filter(a => a.status === 'izin').length;
            const todayAttendance = database.attendance.filter(a => a.date === new Date().toISOString().split('T')[0]).length;
            
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-3xl font-bold text-gray-900">Dashboard Kepala Sekolah</h2>
                        <div class="text-sm text-gray-500">
                            <i class="fas fa-calendar mr-1"></i>
                            ${new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                        </div>
                    </div>
                    
                    <!-- School Overview Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                    <i class="fas fa-users text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Siswa</p>
                                    <p class="text-2xl font-bold text-gray-900">${totalStudents}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-green-100 text-green-600">
                                    <i class="fas fa-chalkboard-teacher text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Guru</p>
                                    <p class="text-2xl font-bold text-gray-900">${totalTeachers}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                                    <i class="fas fa-clipboard-list text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Total Record Absensi</p>
                                    <p class="text-2xl font-bold text-gray-900">${totalAttendance}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                                    <i class="fas fa-calendar-check text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Absensi Hari Ini</p>
                                    <p class="text-2xl font-bold text-gray-900">${todayAttendance}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Overall Attendance Categories -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Kategori Absensi Keseluruhan Sekolah</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center p-4 bg-green-50 rounded-lg border border-green-200">
                                <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-check text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-green-600">${presentCount}</p>
                                <p class="text-sm text-green-700">Hadir</p>
                                <p class="text-xs text-green-600">${totalAttendance > 0 ? ((presentCount/totalAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                            <div class="text-center p-4 bg-red-50 rounded-lg border border-red-200">
                                <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-times text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-red-600">${absentCount}</p>
                                <p class="text-sm text-red-700">Alpha</p>
                                <p class="text-xs text-red-600">${totalAttendance > 0 ? ((absentCount/totalAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                            <div class="text-center p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                                <div class="w-12 h-12 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-thermometer-half text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-yellow-600">${sickCount}</p>
                                <p class="text-sm text-yellow-700">Sakit</p>
                                <p class="text-xs text-yellow-600">${totalAttendance > 0 ? ((sickCount/totalAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                            <div class="text-center p-4 bg-blue-50 rounded-lg border border-blue-200">
                                <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-2">
                                    <i class="fas fa-hand-paper text-white text-xl"></i>
                                </div>
                                <p class="text-2xl font-bold text-blue-600">${permitCount}</p>
                                <p class="text-sm text-blue-700">Izin</p>
                                <p class="text-xs text-blue-600">${totalAttendance > 0 ? ((permitCount/totalAttendance)*100).toFixed(1) : 0}%</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Aksi Cepat</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="navigateTo('all-attendance')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition duration-200 group">
                                <i class="fas fa-users text-2xl text-gray-400 group-hover:text-blue-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-600 group-hover:text-blue-600">Absensi Siswa</p>
                            </button>
                            <button onclick="navigateTo('teacher-summary')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition duration-200 group">
                                <i class="fas fa-chalkboard-teacher text-2xl text-gray-400 group-hover:text-green-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-600 group-hover:text-green-600">Ringkasan Guru</p>
                            </button>
                            <button onclick="navigateTo('teacher-attendance')" class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition duration-200 group">
                                <i class="fas fa-map-marker-alt text-2xl text-gray-400 group-hover:text-purple-500 mb-2"></i>
                                <p class="text-sm font-medium text-gray-600 group-hover:text-purple-600">Kehadiran Guru</p>
                            </button>
                            <div class="p-4 border-2 border-dashed border-gray-200 rounded-lg bg-gray-50">
                                <i class="fas fa-chart-line text-2xl text-gray-300 mb-2"></i>
                                <p class="text-sm font-medium text-gray-400">Analisis Trend</p>
                                <p class="text-xs text-gray-400">Segera hadir</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // User Management Functions
        function showAddUserModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-900">Tambah User Baru</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form onsubmit="addUser(event)" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="userName" class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                                <input type="text" id="userName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="userType" class="block text-sm font-medium text-gray-700 mb-2">Tipe User</label>
                                <select id="userType" required onchange="handleUserTypeChange()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Pilih Tipe User</option>
                                    <option value="admin">Administrator</option>
                                    <option value="guru">Guru</option>
                                    <option value="wali">Wali Kelas</option>
                                    <option value="kepala">Kepala Sekolah</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="additionalFields" class="space-y-4"></div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                                Batal
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                <i class="fas fa-save mr-2"></i>Simpan User
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        function handleUserTypeChange() {
            const userType = document.getElementById('userType').value;
            const additionalFields = document.getElementById('additionalFields');
            
            if (userType === 'guru') {
                additionalFields.innerHTML = `
                    <div>
                        <label for="userSubject" class="block text-sm font-medium text-gray-700 mb-2">Mata Pelajaran</label>
                        <input type="text" id="userSubject" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Contoh: Matematika">
                    </div>
                `;
            } else if (userType === 'wali') {
                additionalFields.innerHTML = `
                    <div>
                        <label for="userClass" class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                        <select id="userClass" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Pilih Kelas</option>
                            <option value="X-1">X-1</option>
                            <option value="X-2">X-2</option>
                            <option value="XI-1">XI-1</option>
                            <option value="XI-2">XI-2</option>
                            <option value="XII-1">XII-1</option>
                            <option value="XII-2">XII-2</option>
                        </select>
                    </div>
                `;
            } else {
                additionalFields.innerHTML = '';
            }
        }

        function addUser(event) {
            event.preventDefault();
            
            const name = document.getElementById('userName').value.trim();
            const type = document.getElementById('userType').value;
            const subject = document.getElementById('userSubject')?.value.trim();
            const className = document.getElementById('userClass')?.value;
            
            if (!name || !type) {
                showNotification('Nama dan tipe user harus diisi!', 'error');
                return;
            }
            
            const newUser = {
                id: generateId('users'),
                uniqueCode: generateUniqueCode(type),
                type: type,
                name: name,
                active: true,
                createdAt: new Date().toISOString().split('T')[0]
            };
            
            if (subject) newUser.subject = subject;
            if (className) newUser.class = className;
            
            updateDatabase(() => {
                database.users.push(newUser);
            });
            
            closeModal();
            renderUsersManagement();
            showNotification(`User ${newUser.name} berhasil ditambahkan dengan kode ${newUser.uniqueCode}!`, 'success');
        }

        function editUser(userId) {
            const user = database.users.find(u => u.id === userId);
            if (!user) return;
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-900">Edit User</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form onsubmit="updateUser(event, ${userId})" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="editUserName" class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                                <input type="text" id="editUserName" value="${user.name}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="editUserCode" class="block text-sm font-medium text-gray-700 mb-2">Kode Unik</label>
                                <input type="text" id="editUserCode" value="${user.uniqueCode}" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-600">
                            </div>
                        </div>
                        
                        ${user.subject ? `
                            <div>
                                <label for="editUserSubject" class="block text-sm font-medium text-gray-700 mb-2">Mata Pelajaran</label>
                                <input type="text" id="editUserSubject" value="${user.subject}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        ` : ''}
                        
                        ${user.class ? `
                            <div>
                                <label for="editUserClass" class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                                <select id="editUserClass" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="X-1" ${user.class === 'X-1' ? 'selected' : ''}>X-1</option>
                                    <option value="X-2" ${user.class === 'X-2' ? 'selected' : ''}>X-2</option>
                                    <option value="XI-1" ${user.class === 'XI-1' ? 'selected' : ''}>XI-1</option>
                                    <option value="XI-2" ${user.class === 'XI-2' ? 'selected' : ''}>XI-2</option>
                                    <option value="XII-1" ${user.class === 'XII-1' ? 'selected' : ''}>XII-1</option>
                                    <option value="XII-2" ${user.class === 'XII-2' ? 'selected' : ''}>XII-2</option>
                                </select>
                            </div>
                        ` : ''}
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                                Batal
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                <i class="fas fa-save mr-2"></i>Update User
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        function updateUser(event, userId) {
            event.preventDefault();
            
            const name = document.getElementById('editUserName').value.trim();
            const subject = document.getElementById('editUserSubject')?.value.trim();
            const className = document.getElementById('editUserClass')?.value;
            
            if (!name) {
                showNotification('Nama user harus diisi!', 'error');
                return;
            }
            
            updateDatabase(() => {
                const userIndex = database.users.findIndex(u => u.id === userId);
                if (userIndex !== -1) {
                    database.users[userIndex].name = name;
                    if (subject) database.users[userIndex].subject = subject;
                    if (className) database.users[userIndex].class = className;
                }
            });
            
            closeModal();
            renderUsersManagement();
            showNotification('Data user berhasil diupdate!', 'success');
        }

        function toggleUserStatus(userId) {
            updateDatabase(() => {
                const user = database.users.find(u => u.id === userId);
                if (user) {
                    user.active = !user.active;
                }
            });
            
            renderUsersManagement();
            const user = database.users.find(u => u.id === userId);
            showNotification(`User ${user.name} berhasil ${user.active ? 'diaktifkan' : 'dinonaktifkan'}!`, 'success');
        }

        function deleteUser(userId) {
            const user = database.users.find(u => u.id === userId);
            if (!user) return;
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-red-600">Konfirmasi Hapus User</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>
                                <div>
                                    <h4 class="font-medium text-red-800">Peringatan!</h4>
                                    <p class="text-red-700 text-sm mt-1">Tindakan ini tidak dapat dibatalkan.</p>
                                </div>
                            </div>
                        </div>
                        
                        <p class="text-gray-700">Apakah Anda yakin ingin menghapus user berikut?</p>
                        <div class="mt-3 p-3 bg-gray-50 rounded-lg">
                            <p class="font-medium">${user.name}</p>
                            <p class="text-sm text-gray-600">Kode: ${user.uniqueCode}</p>
                            <p class="text-sm text-gray-600">Tipe: ${user.type}</p>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Batal
                        </button>
                        <button onclick="confirmDeleteUser(${userId})" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            <i class="fas fa-trash mr-2"></i>Hapus User
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        function confirmDeleteUser(userId) {
            const user = database.users.find(u => u.id === userId);
            
            updateDatabase(() => {
                database.users = database.users.filter(u => u.id !== userId);
            });
            
            closeModal();
            renderUsersManagement();
            showNotification(`User ${user.name} berhasil dihapus!`, 'success');
        }

        function closeModal() {
            document.getElementById('modalContainer').classList.add('hidden');
        }

        // Student Management Functions
        function showAddStudentModal() {
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-900">Tambah Siswa Baru</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form onsubmit="addStudent(event)" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="studentName" class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                                <input type="text" id="studentName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="studentNISN" class="block text-sm font-medium text-gray-700 mb-2">NISN</label>
                                <input type="text" id="studentNISN" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="10 digit NISN">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="studentClass" class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                                <select id="studentClass" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Pilih Kelas</option>
                                    <option value="X-1">X-1</option>
                                    <option value="X-2">X-2</option>
                                    <option value="XI-1">XI-1</option>
                                    <option value="XI-2">XI-2</option>
                                    <option value="XII-1">XII-1</option>
                                    <option value="XII-2">XII-2</option>
                                </select>
                            </div>
                            <div>
                                <label for="studentPhone" class="block text-sm font-medium text-gray-700 mb-2">No. Telepon</label>
                                <input type="tel" id="studentPhone" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="08xxxxxxxxxx">
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                                Batal
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                <i class="fas fa-save mr-2"></i>Simpan Siswa
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        function addStudent(event) {
            event.preventDefault();
            
            const name = document.getElementById('studentName').value.trim();
            const nisn = document.getElementById('studentNISN').value.trim();
            const className = document.getElementById('studentClass').value;
            const phone = document.getElementById('studentPhone').value.trim();
            
            if (!name || !nisn || !className || !phone) {
                showNotification('Semua field harus diisi!', 'error');
                return;
            }
            
            // Check if NISN already exists
            if (database.students.find(s => s.nisn === nisn)) {
                showNotification('NISN sudah terdaftar!', 'error');
                return;
            }
            
            const newStudent = {
                id: generateId('students'),
                name: name,
                nisn: nisn,
                class: className,
                phone: phone
            };
            
            updateDatabase(() => {
                database.students.push(newStudent);
            });
            
            closeModal();
            renderStudentsManagement();
            showNotification(`Siswa ${newStudent.name} berhasil ditambahkan!`, 'success');
        }

        function editStudent(studentId) {
            const student = database.students.find(s => s.id === studentId);
            if (!student) return;
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-900">Edit Data Siswa</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form onsubmit="updateStudent(event, ${studentId})" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="editStudentName" class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                                <input type="text" id="editStudentName" value="${student.name}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="editStudentNISN" class="block text-sm font-medium text-gray-700 mb-2">NISN</label>
                                <input type="text" id="editStudentNISN" value="${student.nisn}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="editStudentClass" class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                                <select id="editStudentClass" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="X-1" ${student.class === 'X-1' ? 'selected' : ''}>X-1</option>
                                    <option value="X-2" ${student.class === 'X-2' ? 'selected' : ''}>X-2</option>
                                    <option value="XI-1" ${student.class === 'XI-1' ? 'selected' : ''}>XI-1</option>
                                    <option value="XI-2" ${student.class === 'XI-2' ? 'selected' : ''}>XI-2</option>
                                    <option value="XII-1" ${student.class === 'XII-1' ? 'selected' : ''}>XII-1</option>
                                    <option value="XII-2" ${student.class === 'XII-2' ? 'selected' : ''}>XII-2</option>
                                </select>
                            </div>
                            <div>
                                <label for="editStudentPhone" class="block text-sm font-medium text-gray-700 mb-2">No. Telepon</label>
                                <input type="tel" id="editStudentPhone" value="${student.phone}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                                Batal
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                <i class="fas fa-save mr-2"></i>Update Siswa
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        function updateStudent(event, studentId) {
            event.preventDefault();
            
            const name = document.getElementById('editStudentName').value.trim();
            const nisn = document.getElementById('editStudentNISN').value.trim();
            const className = document.getElementById('editStudentClass').value;
            const phone = document.getElementById('editStudentPhone').value.trim();
            
            if (!name || !nisn || !className || !phone) {
                showNotification('Semua field harus diisi!', 'error');
                return;
            }
            
            // Check if NISN already exists (excluding current student)
            if (database.students.find(s => s.nisn === nisn && s.id !== studentId)) {
                showNotification('NISN sudah terdaftar!', 'error');
                return;
            }
            
            updateDatabase(() => {
                const studentIndex = database.students.findIndex(s => s.id === studentId);
                if (studentIndex !== -1) {
                    database.students[studentIndex] = {
                        ...database.students[studentIndex],
                        name: name,
                        nisn: nisn,
                        class: className,
                        phone: phone
                    };
                }
            });
            
            closeModal();
            renderStudentsManagement();
            showNotification('Data siswa berhasil diupdate!', 'success');
        }

        function deleteStudent(studentId) {
            const student = database.students.find(s => s.id === studentId);
            if (!student) return;
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-red-600">Konfirmasi Hapus Siswa</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>
                                <div>
                                    <h4 class="font-medium text-red-800">Peringatan!</h4>
                                    <p class="text-red-700 text-sm mt-1">Data siswa dan riwayat absensinya akan terhapus.</p>
                                </div>
                            </div>
                        </div>
                        
                        <p class="text-gray-700">Apakah Anda yakin ingin menghapus siswa berikut?</p>
                        <div class="mt-3 p-3 bg-gray-50 rounded-lg">
                            <p class="font-medium">${student.name}</p>
                            <p class="text-sm text-gray-600">NISN: ${student.nisn}</p>
                            <p class="text-sm text-gray-600">Kelas: ${student.class}</p>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Batal
                        </button>
                        <button onclick="confirmDeleteStudent(${studentId})" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            <i class="fas fa-trash mr-2"></i>Hapus Siswa
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        function confirmDeleteStudent(studentId) {
            const student = database.students.find(s => s.id === studentId);
            
            updateDatabase(() => {
                database.students = database.students.filter(s => s.id !== studentId);
                // Also remove related attendance records
                database.attendance = database.attendance.filter(a => a.studentId !== studentId);
            });
            
            closeModal();
            renderStudentsManagement();
            showNotification(`Siswa ${student.name} berhasil dihapus!`, 'success');
        }

        // Attendance deletion function
        function confirmDeleteAttendance(attendanceId) {
            const attendance = database.attendance.find(a => a.id === attendanceId);
            const student = database.students.find(s => s.id === attendance.studentId);
            
            updateDatabase(() => {
                database.attendance = database.attendance.filter(a => a.id !== attendanceId);
            });
            
            closeModal();
            renderAttendanceReports();
            showNotification(`Data absensi ${student?.name} berhasil dihapus!`, 'success');
        }

        // Geolocation functions
        let currentCoordinates = null;
        
        function getLocation() {
            if (navigator.geolocation) {
                showNotification('Mendeteksi lokasi...', 'info');
                navigator.geolocation.getCurrentPosition(showPosition, showError, {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                });
            } else {
                showNotification('Geolocation tidak didukung oleh browser ini!', 'error');
            }
        }
        
        function showPosition(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            currentCoordinates = `${lat}, ${lon}`;
            
            // Use reverse geocoding to get address (mock implementation)
            const locationName = `Lokasi: ${lat.toFixed(6)}, ${lon.toFixed(6)}`;
            document.getElementById('teacherLocation').value = locationName;
            
            // Enable check-in button
            const checkinButton = document.getElementById('checkinButton');
            checkinButton.disabled = false;
            checkinButton.className = 'bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition duration-200';
            checkinButton.innerHTML = '<i class="fas fa-map-marker-alt mr-2"></i>Check-in Guru';
            
            showNotification('Lokasi berhasil terdeteksi!', 'success');
        }
        
        function showError(error) {
            let message = '';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    message = 'Akses lokasi ditolak. Silakan izinkan akses lokasi.';
                    break;
                case error.POSITION_UNAVAILABLE:
                    message = 'Informasi lokasi tidak tersedia.';
                    break;
                case error.TIMEOUT:
                    message = 'Timeout dalam mendeteksi lokasi.';
                    break;
                default:
                    message = 'Terjadi kesalahan dalam mendeteksi lokasi.';
                    break;
            }
            showNotification(message, 'error');
        }

        // Teacher attendance functions
        function teacherCheckIn(event) {
            event.preventDefault();
            
            const teacherClass = document.getElementById('teacherClass').value;
            const location = document.getElementById('teacherLocation').value.trim();
            const material = document.getElementById('teacherMaterial').value.trim();
            
            if (!teacherClass || !location || !material) {
                showNotification('Semua field harus diisi!', 'error');
                return;
            }
            
            if (!currentCoordinates) {
                showNotification('Lokasi belum terdeteksi! Klik tombol lokasi terlebih dahulu.', 'error');
                return;
            }
            
            const currentTeacher = database.teachers.find(t => t.uniqueCode === currentUser.uniqueCode);
            if (!currentTeacher) {
                showNotification('Data guru tidak ditemukan!', 'error');
                return;
            }
            
            const newTeacherAttendance = {
                id: generateId('teacherAttendance'),
                teacherId: currentTeacher.id,
                date: new Date().toISOString().split('T')[0],
                time: new Date().toTimeString().slice(0, 8),
                location: location,
                coordinates: currentCoordinates,
                subject: currentUser.subject,
                class: teacherClass,
                material: material
            };
            
            updateDatabase(() => {
                database.teacherAttendance.push(newTeacherAttendance);
            });
            
            // Reset form
            document.getElementById('teacherClass').value = '';
            document.getElementById('teacherLocation').value = '';
            document.getElementById('teacherMaterial').value = '';
            currentCoordinates = null;
            
            // Disable check-in button again
            const checkinButton = document.getElementById('checkinButton');
            checkinButton.disabled = true;
            checkinButton.className = 'bg-gray-400 text-white px-6 py-2 rounded-lg cursor-not-allowed';
            checkinButton.innerHTML = '<i class="fas fa-map-marker-alt mr-2"></i>Check-in Guru (Menunggu Lokasi)';
            
            showNotification('Check-in guru berhasil!', 'success');
        }

        function loadStudentsByClass() {
            const selectedClass = document.getElementById('studentClass').value;
            const studentsListContainer = document.getElementById('studentsAttendanceList');
            
            if (!selectedClass) {
                studentsListContainer.innerHTML = '<p class="text-gray-500 text-center py-4">Pilih kelas untuk menampilkan daftar siswa</p>';
                return;
            }
            
            const classStudents = database.students.filter(s => s.class === selectedClass);
            
            if (classStudents.length === 0) {
                studentsListContainer.innerHTML = '<p class="text-gray-500 text-center py-4">Tidak ada siswa di kelas ini</p>';
                return;
            }
            
            studentsListContainer.innerHTML = `
                <div class="border border-gray-200 rounded-lg">
                    <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                        <h4 class="font-medium text-gray-900">Daftar Siswa Kelas ${selectedClass}</h4>
                    </div>
                    <div class="divide-y divide-gray-200">
                        ${classStudents.map(student => `
                            <div class="p-4 flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <span class="font-medium text-gray-900">${student.name}</span>
                                    <span class="text-sm text-gray-500">(${student.nisn})</span>
                                </div>
                                <div class="flex space-x-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="attendance_${student.id}" value="hadir" class="mr-1 text-green-600">
                                        <span class="text-sm text-green-600">Hadir</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="attendance_${student.id}" value="alpha" class="mr-1 text-red-600">
                                        <span class="text-sm text-red-600">Alpha</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="attendance_${student.id}" value="sakit" class="mr-1 text-yellow-600">
                                        <span class="text-sm text-yellow-600">Sakit</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="attendance_${student.id}" value="izin" class="mr-1 text-blue-600">
                                        <span class="text-sm text-blue-600">Izin</span>
                                    </label>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function markAllPresent() {
            const selectedClass = document.getElementById('studentClass').value;
            if (!selectedClass) {
                showNotification('Pilih kelas terlebih dahulu!', 'error');
                return;
            }
            
            const classStudents = database.students.filter(s => s.class === selectedClass);
            classStudents.forEach(student => {
                const hadirRadio = document.querySelector(`input[name="attendance_${student.id}"][value="hadir"]`);
                if (hadirRadio) {
                    hadirRadio.checked = true;
                }
            });
            
            showNotification('Semua siswa ditandai hadir!', 'success');
        }

        function inputStudentAttendance(event) {
            event.preventDefault();
            
            const selectedClass = document.getElementById('studentClass').value;
            const date = document.getElementById('attendanceDate').value;
            const time = document.getElementById('attendanceTime').value;
            const material = document.getElementById('lessonMaterial').value.trim();
            
            if (!selectedClass || !date || !time || !material) {
                showNotification('Semua field harus diisi!', 'error');
                return;
            }
            
            const classStudents = database.students.filter(s => s.class === selectedClass);
            const currentTeacher = database.teachers.find(t => t.uniqueCode === currentUser.uniqueCode);
            
            if (!currentTeacher) {
                showNotification('Data guru tidak ditemukan!', 'error');
                return;
            }
            
            let attendanceRecords = [];
            let hasAttendance = false;
            
            classStudents.forEach(student => {
                const attendanceStatus = document.querySelector(`input[name="attendance_${student.id}"]:checked`);
                if (attendanceStatus) {
                    hasAttendance = true;
                    const newAttendance = {
                        id: generateId('attendance'),
                        studentId: student.id,
                        teacherId: currentTeacher.id,
                        date: date,
                        time: time + ':00',
                        status: attendanceStatus.value,
                        subject: currentUser.subject,
                        class: selectedClass,
                        location: 'Ruang Kelas ' + selectedClass + ', Lantai 2',
                        material: material
                    };
                    attendanceRecords.push(newAttendance);
                }
            });
            
            if (!hasAttendance) {
                showNotification('Pilih status absensi untuk minimal satu siswa!', 'error');
                return;
            }
            
            updateDatabase(() => {
                database.attendance.push(...attendanceRecords);
            });
            
            // Reset form
            document.getElementById('studentClass').value = '';
            document.getElementById('lessonMaterial').value = '';
            document.getElementById('studentsAttendanceList').innerHTML = '<p class="text-gray-500 text-center py-4">Pilih kelas untuk menampilkan daftar siswa</p>';
            
            showNotification(`Absensi ${attendanceRecords.length} siswa berhasil disimpan!`, 'success');
        }

        // Attendance categorization functions
        function getAttendanceCategory(studentId) {
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            const thirtyDaysAgoStr = thirtyDaysAgo.toISOString().split('T')[0];
            
            const studentAttendance = database.attendance.filter(att => 
                att.studentId === studentId && att.date >= thirtyDaysAgoStr
            );
            
            const alphaCount = studentAttendance.filter(att => att.status === 'alpha').length;
            const sickCount = studentAttendance.filter(att => att.status === 'sakit').length;
            
            if (alphaCount > 7) {
                return {
                    category: 'critical_alpha',
                    label: 'Kritis Alpha',
                    color: 'bg-red-600 text-white',
                    count: alphaCount,
                    type: 'alpha'
                };
            } else if (alphaCount >= 5 && alphaCount <= 7) {
                return {
                    category: 'high_alpha',
                    label: 'Tinggi Alpha',
                    color: 'bg-red-400 text-white',
                    count: alphaCount,
                    type: 'alpha'
                };
            } else if (alphaCount >= 3 && alphaCount <= 4) {
                return {
                    category: 'medium_alpha',
                    label: 'Sedang Alpha',
                    color: 'bg-orange-500 text-white',
                    count: alphaCount,
                    type: 'alpha'
                };
            } else if (sickCount > 7) {
                return {
                    category: 'high_sick',
                    label: 'Sering Sakit',
                    color: 'bg-yellow-500 text-white',
                    count: sickCount,
                    type: 'sakit'
                };
            }
            
            return {
                category: 'normal',
                label: 'Normal',
                color: 'bg-green-500 text-white',
                count: 0,
                type: 'normal'
            };
        }

        function getCategorizedStudents(classFilter = null) {
            let students = database.students;
            if (classFilter) {
                students = students.filter(s => s.class === classFilter);
            }
            
            const categorized = {
                critical_alpha: [],
                high_alpha: [],
                medium_alpha: [],
                high_sick: [],
                normal: []
            };
            
            students.forEach(student => {
                const category = getAttendanceCategory(student.id);
                categorized[category.category].push({
                    ...student,
                    categoryInfo: category
                });
            });
            
            return categorized;
        }

        // Message templates storage
        function getDefaultTemplates() {
            const schoolName = "SMA Negeri 1 Jakarta";
            return {
                critical_alpha: `Assalamualaikum Wr. Wb.

Yth. Orang Tua/Wali dari {NAMA_SISWA}

Kami dari ${schoolName} ingin menginformasikan bahwa putra/putri Anda telah mencapai tingkat ketidakhadiran yang mengkhawatirkan.

📊 Data Kehadiran (30 hari terakhir):
• Alpha (tanpa keterangan): {JUMLAH} hari
• Status: KRITIS - Memerlukan perhatian segera

⚠️ Dampak yang dapat terjadi:
- Ketinggalan materi pelajaran
- Nilai akademik menurun
- Pelanggaran tata tertib sekolah

🙏 Mohon segera menghubungi wali kelas untuk koordinasi lebih lanjut.

Terima kasih atas perhatian dan kerjasamanya.

Wassalamualaikum Wr. Wb.
${schoolName}`,

                high_alpha: `Assalamualaikum Wr. Wb.

Yth. Orang Tua/Wali dari {NAMA_SISWA}

Kami dari ${schoolName} ingin menginformasikan kondisi kehadiran putra/putri Anda.

📊 Data Kehadiran (30 hari terakhir):
• Alpha (tanpa keterangan): {JUMLAH} hari
• Status: TINGGI - Perlu perhatian khusus

💡 Saran tindak lanjut:
- Komunikasi intensif dengan anak
- Koordinasi dengan wali kelas
- Monitoring kehadiran harian

Terima kasih atas perhatian Bapak/Ibu.

Wassalamualaikum Wr. Wb.
${schoolName}`,

                medium_alpha: `Assalamualaikum Wr. Wb.

Yth. Orang Tua/Wali dari {NAMA_SISWA}

Kami dari ${schoolName} ingin menginformasikan kondisi kehadiran putra/putri Anda.

📊 Data Kehadiran (30 hari terakhir):
• Alpha (tanpa keterangan): {JUMLAH} hari
• Status: SEDANG - Perlu pengawasan

📝 Himbauan:
- Pastikan anak berangkat sekolah tepat waktu
- Komunikasi rutin tentang aktivitas sekolah
- Hubungi sekolah jika ada kendala

Terima kasih atas kerjasamanya.

Wassalamualaikum Wr. Wb.
${schoolName}`,

                high_sick: `Assalamualaikum Wr. Wb.

Yth. Orang Tua/Wali dari {NAMA_SISWA}

Kami dari ${schoolName} ingin menginformasikan kondisi kehadiran putra/putri Anda.

📊 Data Kehadiran (30 hari terakhir):
• Sakit: {JUMLAH} hari
• Status: SERING SAKIT - Perlu perhatian kesehatan

🏥 Saran:
- Konsultasi dengan dokter untuk pemeriksaan kesehatan
- Perbaiki pola makan dan istirahat
- Koordinasi dengan sekolah untuk program catch-up

Semoga putra/putri Anda segera sehat dan dapat mengikuti pembelajaran dengan baik.

Wassalamualaikum Wr. Wb.
${schoolName}`
            };
        }

        function getMessageTemplates() {
            const saved = localStorage.getItem('whatsappTemplates');
            return saved ? JSON.parse(saved) : getDefaultTemplates();
        }

        function saveMessageTemplates(templates) {
            localStorage.setItem('whatsappTemplates', JSON.stringify(templates));
        }

        function getWhatsAppMessageTemplate(category, studentName, count, type) {
            const templates = getMessageTemplates();
            let template = templates[category] || templates.medium_alpha;
            
            // Replace placeholders
            template = template.replace(/{NAMA_SISWA}/g, studentName);
            template = template.replace(/{JUMLAH}/g, count);
            
            return template;
        }

        // Auto focus on login input
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from localStorage on page load
            loadFromLocalStorage();
            document.getElementById('uniqueCode').focus();
            
            // Auto-detect location when input attendance page is loaded
            setTimeout(() => {
                if (currentUser && currentUser.type === 'guru' && document.getElementById('teacherLocation')) {
                    getLocation();
                }
            }, 1000);
        });

        // Render attendance categories pages
        function renderAttendanceCategories() {
            const mainContent = document.getElementById('mainContent');
            const categorizedStudents = getCategorizedStudents();
            
            mainContent.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-900">Kategori Kehadiran Siswa (Admin)</h2>
                    
                    <!-- Category Summary -->
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        <div class="bg-red-600 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold">${categorizedStudents.critical_alpha.length}</div>
                            <div class="text-sm">Kritis Alpha (>7)</div>
                        </div>
                        <div class="bg-red-400 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold">${categorizedStudents.high_alpha.length}</div>
                            <div class="text-sm">Tinggi Alpha (5-7)</div>
                        </div>
                        <div class="bg-orange-500 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold">${categorizedStudents.medium_alpha.length}</div>
                            <div class="text-sm">Sedang Alpha (3-4)</div>
                        </div>
                        <div class="bg-yellow-500 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold">${categorizedStudents.high_sick.length}</div>
                            <div class="text-sm">Sering Sakit (>7)</div>
                        </div>
                        <div class="bg-green-500 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold">${categorizedStudents.normal.length}</div>
                            <div class="text-sm">Normal</div>
                        </div>
                    </div>

                    ${renderCategorySection('Kritis Alpha (>7 hari)', categorizedStudents.critical_alpha, 'critical_alpha')}
                    ${renderCategorySection('Tinggi Alpha (5-7 hari)', categorizedStudents.high_alpha, 'high_alpha')}
                    ${renderCategorySection('Sedang Alpha (3-4 hari)', categorizedStudents.medium_alpha, 'medium_alpha')}
                    ${renderCategorySection('Sering Sakit (>7 hari)', categorizedStudents.high_sick, 'high_sick')}
                </div>
            `;
        }

        function renderClassCategories() {
            const mainContent = document.getElementById('mainContent');
            const categorizedStudents = getCategorizedStudents(currentUser.class);
            
            mainContent.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-900">Kategori Kehadiran Kelas ${currentUser.class}</h2>
                    
                    <!-- Category Summary -->
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        <div class="bg-red-600 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold">${categorizedStudents.critical_alpha.length}</div>
                            <div class="text-sm">Kritis Alpha (>7)</div>
                        </div>
                        <div class="bg-red-400 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold">${categorizedStudents.high_alpha.length}</div>
                            <div class="text-sm">Tinggi Alpha (5-7)</div>
                        </div>
                        <div class="bg-orange-500 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold">${categorizedStudents.medium_alpha.length}</div>
                            <div class="text-sm">Sedang Alpha (3-4)</div>
                        </div>
                        <div class="bg-yellow-500 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold">${categorizedStudents.high_sick.length}</div>
                            <div class="text-sm">Sering Sakit (>7)</div>
                        </div>
                        <div class="bg-green-500 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold">${categorizedStudents.normal.length}</div>
                            <div class="text-sm">Normal</div>
                        </div>
                    </div>

                    ${renderCategorySection('Kritis Alpha (>7 hari)', categorizedStudents.critical_alpha, 'critical_alpha')}
                    ${renderCategorySection('Tinggi Alpha (5-7 hari)', categorizedStudents.high_alpha, 'high_alpha')}
                    ${renderCategorySection('Sedang Alpha (3-4 hari)', categorizedStudents.medium_alpha, 'medium_alpha')}
                    ${renderCategorySection('Sering Sakit (>7 hari)', categorizedStudents.high_sick, 'high_sick')}
                </div>
            `;
        }

        function renderSchoolCategories() {
            const mainContent = document.getElementById('mainContent');
            const categorizedStudents = getCategorizedStudents();
            
            mainContent.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-900">Kategori Kehadiran Seluruh Sekolah</h2>
                    
                    <!-- Category Summary -->
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        <div class="bg-red-600 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold">${categorizedStudents.critical_alpha.length}</div>
                            <div class="text-sm">Kritis Alpha (>7)</div>
                        </div>
                        <div class="bg-red-400 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold">${categorizedStudents.high_alpha.length}</div>
                            <div class="text-sm">Tinggi Alpha (5-7)</div>
                        </div>
                        <div class="bg-orange-500 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold">${categorizedStudents.medium_alpha.length}</div>
                            <div class="text-sm">Sedang Alpha (3-4)</div>
                        </div>
                        <div class="bg-yellow-500 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold">${categorizedStudents.high_sick.length}</div>
                            <div class="text-sm">Sering Sakit (>7)</div>
                        </div>
                        <div class="bg-green-500 text-white p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold">${categorizedStudents.normal.length}</div>
                            <div class="text-sm">Normal</div>
                        </div>
                    </div>

                    ${renderCategorySection('Kritis Alpha (>7 hari)', categorizedStudents.critical_alpha, 'critical_alpha')}
                    ${renderCategorySection('Tinggi Alpha (5-7 hari)', categorizedStudents.high_alpha, 'high_alpha')}
                    ${renderCategorySection('Sedang Alpha (3-4 hari)', categorizedStudents.medium_alpha, 'medium_alpha')}
                    ${renderCategorySection('Sering Sakit (>7 hari)', categorizedStudents.high_sick, 'high_sick')}
                </div>
            `;
        }

        function renderCategorySection(title, students, categoryType) {
            if (students.length === 0) return '';
            
            return `
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-900">${title}</h3>
                        <span class="px-3 py-1 text-sm rounded-full ${students[0]?.categoryInfo?.color || 'bg-gray-500 text-white'}">${students.length} siswa</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Siswa</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NISN</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kelas</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jumlah</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${students.map(student => `
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student.name}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.nisn}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.class}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${student.categoryInfo.count} ${student.categoryInfo.type}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 py-1 text-xs rounded-full ${student.categoryInfo.color}">${student.categoryInfo.label}</span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button onclick="sendWhatsAppMessage('${student.categoryInfo.category}', '${student.name}', '${student.phone}', ${student.categoryInfo.count})" class="text-green-600 hover:text-green-900 mr-3">
                                                <i class="fab fa-whatsapp"></i> Kirim WA
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // WhatsApp messaging functions
        function renderWhatsAppMessages() {
            const mainContent = document.getElementById('mainContent');
            const categorizedStudents = getCategorizedStudents();
            
            mainContent.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-900">Pesan WhatsApp untuk Orang Tua (Admin)</h2>
                    
                    <!-- Quick Send Options -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Kirim Pesan Massal</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="sendBulkMessages('critical_alpha')" class="p-4 border-2 border-red-300 rounded-lg hover:bg-red-50 transition duration-200 group">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-red-700">Kritis Alpha</h4>
                                        <p class="text-sm text-red-600">${categorizedStudents.critical_alpha.length} siswa</p>
                                    </div>
                                    <i class="fab fa-whatsapp text-2xl text-green-500"></i>
                                </div>
                            </button>
                            <button onclick="sendBulkMessages('high_alpha')" class="p-4 border-2 border-red-200 rounded-lg hover:bg-red-50 transition duration-200 group">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-red-600">Tinggi Alpha</h4>
                                        <p class="text-sm text-red-500">${categorizedStudents.high_alpha.length} siswa</p>
                                    </div>
                                    <i class="fab fa-whatsapp text-2xl text-green-500"></i>
                                </div>
                            </button>
                            <button onclick="sendBulkMessages('medium_alpha')" class="p-4 border-2 border-orange-300 rounded-lg hover:bg-orange-50 transition duration-200 group">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-orange-700">Sedang Alpha</h4>
                                        <p class="text-sm text-orange-600">${categorizedStudents.medium_alpha.length} siswa</p>
                                    </div>
                                    <i class="fab fa-whatsapp text-2xl text-green-500"></i>
                                </div>
                            </button>
                            <button onclick="sendBulkMessages('high_sick')" class="p-4 border-2 border-yellow-300 rounded-lg hover:bg-yellow-50 transition duration-200 group">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-yellow-700">Sering Sakit</h4>
                                        <p class="text-sm text-yellow-600">${categorizedStudents.high_sick.length} siswa</p>
                                    </div>
                                    <i class="fab fa-whatsapp text-2xl text-green-500"></i>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- Message Templates Editor -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Template Pesan WhatsApp</h3>
                            <div class="space-x-2">
                                <button onclick="showTemplateEditor()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                    <i class="fas fa-edit mr-2"></i>Edit Template
                                </button>
                                <button onclick="resetTemplates()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                                    <i class="fas fa-undo mr-2"></i>Reset Default
                                </button>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label for="templateCategory" class="block text-sm font-medium text-gray-700 mb-2">Pilih Kategori</label>
                                <select id="templateCategory" onchange="previewTemplate()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="critical_alpha">Kritis Alpha</option>
                                    <option value="high_alpha">Tinggi Alpha</option>
                                    <option value="medium_alpha">Sedang Alpha</option>
                                    <option value="high_sick">Sering Sakit</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Preview Pesan</label>
                                <div class="text-xs text-gray-500 mb-2">
                                    Placeholder: <code>{NAMA_SISWA}</code> untuk nama siswa, <code>{JUMLAH}</code> untuk jumlah ketidakhadiran
                                </div>
                                <div id="messagePreview" class="p-4 bg-gray-50 rounded-lg border text-sm whitespace-pre-line"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Initialize preview
            setTimeout(() => previewTemplate(), 100);
        }

        function renderClassWhatsApp() {
            const mainContent = document.getElementById('mainContent');
            const categorizedStudents = getCategorizedStudents(currentUser.class);
            
            mainContent.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-900">Pesan WhatsApp Kelas ${currentUser.class}</h2>
                    
                    <!-- Quick Send Options -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Kirim Pesan Massal Kelas ${currentUser.class}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="sendBulkMessages('critical_alpha', '${currentUser.class}')" class="p-4 border-2 border-red-300 rounded-lg hover:bg-red-50 transition duration-200 group">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-red-700">Kritis Alpha</h4>
                                        <p class="text-sm text-red-600">${categorizedStudents.critical_alpha.length} siswa</p>
                                    </div>
                                    <i class="fab fa-whatsapp text-2xl text-green-500"></i>
                                </div>
                            </button>
                            <button onclick="sendBulkMessages('high_alpha', '${currentUser.class}')" class="p-4 border-2 border-red-200 rounded-lg hover:bg-red-50 transition duration-200 group">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-red-600">Tinggi Alpha</h4>
                                        <p class="text-sm text-red-500">${categorizedStudents.high_alpha.length} siswa</p>
                                    </div>
                                    <i class="fab fa-whatsapp text-2xl text-green-500"></i>
                                </div>
                            </button>
                            <button onclick="sendBulkMessages('medium_alpha', '${currentUser.class}')" class="p-4 border-2 border-orange-300 rounded-lg hover:bg-orange-50 transition duration-200 group">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-orange-700">Sedang Alpha</h4>
                                        <p class="text-sm text-orange-600">${categorizedStudents.medium_alpha.length} siswa</p>
                                    </div>
                                    <i class="fab fa-whatsapp text-2xl text-green-500"></i>
                                </div>
                            </button>
                            <button onclick="sendBulkMessages('high_sick', '${currentUser.class}')" class="p-4 border-2 border-yellow-300 rounded-lg hover:bg-yellow-50 transition duration-200 group">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-yellow-700">Sering Sakit</h4>
                                        <p class="text-sm text-yellow-600">${categorizedStudents.high_sick.length} siswa</p>
                                    </div>
                                    <i class="fab fa-whatsapp text-2xl text-green-500"></i>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- Individual Students -->
                    ${renderCategorySection('Kritis Alpha (>7 hari)', categorizedStudents.critical_alpha, 'critical_alpha')}
                    ${renderCategorySection('Tinggi Alpha (5-7 hari)', categorizedStudents.high_alpha, 'high_alpha')}
                    ${renderCategorySection('Sedang Alpha (3-4 hari)', categorizedStudents.medium_alpha, 'medium_alpha')}
                    ${renderCategorySection('Sering Sakit (>7 hari)', categorizedStudents.high_sick, 'high_sick')}
                </div>
            `;
        }

        function renderSchoolWhatsApp() {
            const mainContent = document.getElementById('mainContent');
            const categorizedStudents = getCategorizedStudents();
            
            mainContent.innerHTML = `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-gray-900">Pesan WhatsApp Seluruh Sekolah</h2>
                    
                    <!-- Quick Send Options -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Kirim Pesan Massal Seluruh Sekolah</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="sendBulkMessages('critical_alpha')" class="p-4 border-2 border-red-300 rounded-lg hover:bg-red-50 transition duration-200 group">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-red-700">Kritis Alpha</h4>
                                        <p class="text-sm text-red-600">${categorizedStudents.critical_alpha.length} siswa</p>
                                    </div>
                                    <i class="fab fa-whatsapp text-2xl text-green-500"></i>
                                </div>
                            </button>
                            <button onclick="sendBulkMessages('high_alpha')" class="p-4 border-2 border-red-200 rounded-lg hover:bg-red-50 transition duration-200 group">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-red-600">Tinggi Alpha</h4>
                                        <p class="text-sm text-red-500">${categorizedStudents.high_alpha.length} siswa</p>
                                    </div>
                                    <i class="fab fa-whatsapp text-2xl text-green-500"></i>
                                </div>
                            </button>
                            <button onclick="sendBulkMessages('medium_alpha')" class="p-4 border-2 border-orange-300 rounded-lg hover:bg-orange-50 transition duration-200 group">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-orange-700">Sedang Alpha</h4>
                                        <p class="text-sm text-orange-600">${categorizedStudents.medium_alpha.length} siswa</p>
                                    </div>
                                    <i class="fab fa-whatsapp text-2xl text-green-500"></i>
                                </div>
                            </button>
                            <button onclick="sendBulkMessages('high_sick')" class="p-4 border-2 border-yellow-300 rounded-lg hover:bg-yellow-50 transition duration-200 group">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-yellow-700">Sering Sakit</h4>
                                        <p class="text-sm text-yellow-600">${categorizedStudents.high_sick.length} siswa</p>
                                    </div>
                                    <i class="fab fa-whatsapp text-2xl text-green-500"></i>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- Class Breakdown -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Breakdown per Kelas</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${['X-1', 'X-2', 'XI-1', 'XI-2', 'XII-1', 'XII-2'].map(className => {
                                const classCategories = getCategorizedStudents(className);
                                const totalProblematic = classCategories.critical_alpha.length + classCategories.high_alpha.length + classCategories.medium_alpha.length + classCategories.high_sick.length;
                                return `
                                    <div class="p-4 border rounded-lg">
                                        <h4 class="font-medium text-gray-900 mb-2">Kelas ${className}</h4>
                                        <div class="space-y-1 text-sm">
                                            <div class="flex justify-between">
                                                <span class="text-red-600">Kritis:</span>
                                                <span>${classCategories.critical_alpha.length}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-red-500">Tinggi:</span>
                                                <span>${classCategories.high_alpha.length}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-orange-600">Sedang:</span>
                                                <span>${classCategories.medium_alpha.length}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-yellow-600">Sakit:</span>
                                                <span>${classCategories.high_sick.length}</span>
                                            </div>
                                            <div class="flex justify-between font-medium border-t pt-1">
                                                <span>Total Perlu Perhatian:</span>
                                                <span>${totalProblematic}</span>
                                            </div>
                                        </div>
                                        ${totalProblematic > 0 ? `
                                            <button onclick="sendClassBulkMessages('${className}')" class="w-full mt-2 px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700">
                                                <i class="fab fa-whatsapp mr-1"></i>Kirim ke Kelas
                                            </button>
                                        ` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // WhatsApp messaging functions
        function sendWhatsAppMessage(category, studentName, phone, count) {
            const message = getWhatsAppMessageTemplate(category, studentName, count, category.includes('alpha') ? 'alpha' : 'sakit');
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/62${phone.replace(/^0/, '')}?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
            showNotification(`Membuka WhatsApp untuk ${studentName}...`, 'success');
        }

        function sendBulkMessages(category, classFilter = null) {
            const categorizedStudents = getCategorizedStudents(classFilter);
            const students = categorizedStudents[category];
            
            if (students.length === 0) {
                showNotification('Tidak ada siswa dalam kategori ini!', 'info');
                return;
            }
            
            const confirmMessage = `Apakah Anda yakin ingin mengirim pesan WhatsApp ke ${students.length} orang tua siswa dalam kategori ${students[0]?.categoryInfo?.label}?`;
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-900">Konfirmasi Kirim Pesan Massal</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <p class="text-gray-700 mb-4">${confirmMessage}</p>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-medium text-blue-800 mb-2">Daftar Siswa:</h4>
                            <div class="max-h-40 overflow-y-auto">
                                ${students.map(student => `
                                    <div class="flex justify-between items-center py-1 text-sm">
                                        <span>${student.name} (${student.class})</span>
                                        <span class="text-blue-600">${student.phone}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Batal
                        </button>
                        <button onclick="confirmBulkMessages('${category}', '${classFilter || ''}')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            <i class="fab fa-whatsapp mr-2"></i>Kirim Semua
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        function confirmBulkMessages(category, classFilter) {
            const categorizedStudents = getCategorizedStudents(classFilter || null);
            const students = categorizedStudents[category];
            
            students.forEach((student, index) => {
                setTimeout(() => {
                    sendWhatsAppMessage(category, student.name, student.phone, student.categoryInfo.count);
                }, index * 1000); // Delay 1 second between each message
            });
            
            closeModal();
            showNotification(`Membuka ${students.length} tab WhatsApp...`, 'success');
        }

        function sendClassBulkMessages(className) {
            const categorizedStudents = getCategorizedStudents(className);
            const allProblematicStudents = [
                ...categorizedStudents.critical_alpha,
                ...categorizedStudents.high_alpha,
                ...categorizedStudents.medium_alpha,
                ...categorizedStudents.high_sick
            ];
            
            if (allProblematicStudents.length === 0) {
                showNotification('Tidak ada siswa yang perlu perhatian di kelas ini!', 'info');
                return;
            }
            
            allProblematicStudents.forEach((student, index) => {
                setTimeout(() => {
                    sendWhatsAppMessage(student.categoryInfo.category, student.name, student.phone, student.categoryInfo.count);
                }, index * 1000);
            });
            
            showNotification(`Membuka ${allProblematicStudents.length} tab WhatsApp untuk kelas ${className}...`, 'success');
        }

        function previewTemplate() {
            const category = document.getElementById('templateCategory').value;
            const message = getWhatsAppMessageTemplate(category, '[Nama Siswa]', '[Jumlah]', category.includes('alpha') ? 'alpha' : 'sakit');
            document.getElementById('messagePreview').textContent = message;
        }

        // Template editor functions
        function showTemplateEditor() {
            const templates = getMessageTemplates();
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6 max-w-4xl">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-900">Edit Template Pesan WhatsApp</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-medium text-blue-800 mb-2">Panduan Placeholder:</h4>
                            <div class="text-sm text-blue-700 space-y-1">
                                <p><code class="bg-blue-100 px-2 py-1 rounded">{NAMA_SISWA}</code> - Akan diganti dengan nama siswa</p>
                                <p><code class="bg-blue-100 px-2 py-1 rounded">{JUMLAH}</code> - Akan diganti dengan jumlah ketidakhadiran</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Kritis Alpha (>7 hari)</label>
                                <textarea id="template_critical_alpha" rows="12" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">${templates.critical_alpha}</textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tinggi Alpha (5-7 hari)</label>
                                <textarea id="template_high_alpha" rows="12" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">${templates.high_alpha}</textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Sedang Alpha (3-4 hari)</label>
                                <textarea id="template_medium_alpha" rows="12" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">${templates.medium_alpha}</textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Sering Sakit (>7 hari)</label>
                                <textarea id="template_high_sick" rows="12" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">${templates.high_sick}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-6 border-t">
                        <button onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Batal
                        </button>
                        <button onclick="saveTemplates()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            <i class="fas fa-save mr-2"></i>Simpan Template
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        function saveTemplates() {
            const newTemplates = {
                critical_alpha: document.getElementById('template_critical_alpha').value,
                high_alpha: document.getElementById('template_high_alpha').value,
                medium_alpha: document.getElementById('template_medium_alpha').value,
                high_sick: document.getElementById('template_high_sick').value
            };
            
            saveMessageTemplates(newTemplates);
            closeModal();
            showNotification('Template pesan berhasil disimpan!', 'success');
            
            // Refresh preview if on WhatsApp page
            if (document.getElementById('messagePreview')) {
                previewTemplate();
            }
        }

        function resetTemplates() {
            const confirmReset = `Apakah Anda yakin ingin mengembalikan semua template ke pengaturan default? Perubahan yang telah dibuat akan hilang.`;
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-900">Konfirmasi Reset Template</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-yellow-500 mr-3"></i>
                                <div>
                                    <h4 class="font-medium text-yellow-800">Peringatan!</h4>
                                    <p class="text-yellow-700 text-sm mt-1">Template yang sudah disesuaikan akan kembali ke pengaturan default.</p>
                                </div>
                            </div>
                        </div>
                        <p class="text-gray-700">${confirmReset}</p>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Batal
                        </button>
                        <button onclick="confirmResetTemplates()" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700">
                            <i class="fas fa-undo mr-2"></i>Reset ke Default
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        function confirmResetTemplates() {
            localStorage.removeItem('whatsappTemplates');
            closeModal();
            showNotification('Template berhasil direset ke pengaturan default!', 'success');
            
            // Refresh preview if on WhatsApp page
            if (document.getElementById('messagePreview')) {
                previewTemplate();
            }
        }

        // Student bulk delete functions
        function toggleAllStudentsSelection() {
            const selectAll = document.getElementById('selectAllStudents');
            const checkboxes = document.querySelectorAll('.student-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }

        function showBulkDeleteStudentsByClass() {
            const selectedClass = document.getElementById('bulkDeleteClass').value;
            
            if (!selectedClass) {
                showNotification('Pilih kelas terlebih dahulu!', 'error');
                return;
            }
            
            const classStudents = database.students.filter(s => s.class === selectedClass);
            
            if (classStudents.length === 0) {
                showNotification('Tidak ada siswa di kelas ini!', 'info');
                return;
            }
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-red-600">Konfirmasi Hapus Siswa Berdasarkan Kelas</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>
                                <div>
                                    <h4 class="font-medium text-red-800">Peringatan!</h4>
                                    <p class="text-red-700 text-sm mt-1">Semua siswa di kelas ${selectedClass} dan riwayat absensinya akan terhapus permanen.</p>
                                </div>
                            </div>
                        </div>
                        
                        <p class="text-gray-700 mb-4">Apakah Anda yakin ingin menghapus <strong>${classStudents.length}</strong> siswa dari kelas <strong>${selectedClass}</strong>?</p>
                        
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 max-h-40 overflow-y-auto">
                            <h4 class="font-medium text-gray-800 mb-2">Siswa yang akan dihapus:</h4>
                            ${classStudents.map(student => `
                                <div class="flex justify-between items-center py-1 text-sm border-b border-gray-200 last:border-b-0">
                                    <span>${student.name}</span>
                                    <span class="text-gray-500">${student.nisn}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Batal
                        </button>
                        <button onclick="confirmBulkDeleteStudentsByClass('${selectedClass}')" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            <i class="fas fa-trash mr-2"></i>Hapus Kelas ${selectedClass}
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        function showBulkDeleteSelectedStudents() {
            const selectedCheckboxes = document.querySelectorAll('.student-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                showNotification('Pilih minimal satu siswa untuk dihapus!', 'error');
                return;
            }
            
            const selectedIds = Array.from(selectedCheckboxes).map(cb => parseInt(cb.value));
            const selectedStudents = database.students.filter(student => selectedIds.includes(student.id));
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-red-600">Konfirmasi Hapus Siswa Terpilih</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>
                                <div>
                                    <h4 class="font-medium text-red-800">Peringatan!</h4>
                                    <p class="text-red-700 text-sm mt-1">Siswa yang dipilih dan riwayat absensinya akan terhapus permanen.</p>
                                </div>
                            </div>
                        </div>
                        
                        <p class="text-gray-700 mb-4">Apakah Anda yakin ingin menghapus <strong>${selectedStudents.length}</strong> siswa yang dipilih?</p>
                        
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 max-h-40 overflow-y-auto">
                            <h4 class="font-medium text-gray-800 mb-2">Siswa yang akan dihapus:</h4>
                            ${selectedStudents.map(student => `
                                <div class="flex justify-between items-center py-1 text-sm border-b border-gray-200 last:border-b-0">
                                    <span>${student.name} (${student.class})</span>
                                    <span class="text-gray-500">${student.nisn}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Batal
                        </button>
                        <button onclick="confirmBulkDeleteSelectedStudents([${selectedIds.join(',')}])" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            <i class="fas fa-trash mr-2"></i>Hapus ${selectedStudents.length} Siswa
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        function confirmBulkDeleteStudentsByClass(className) {
            const classStudents = database.students.filter(s => s.class === className);
            const studentIds = classStudents.map(s => s.id);
            
            updateDatabase(() => {
                database.students = database.students.filter(s => s.class !== className);
                // Also remove related attendance records
                database.attendance = database.attendance.filter(a => !studentIds.includes(a.studentId));
            });
            
            closeModal();
            renderStudentsManagement();
            showNotification(`${classStudents.length} siswa dari kelas ${className} berhasil dihapus!`, 'success');
        }

        function confirmBulkDeleteSelectedStudents(selectedIds) {
            updateDatabase(() => {
                database.students = database.students.filter(s => !selectedIds.includes(s.id));
                // Also remove related attendance records
                database.attendance = database.attendance.filter(a => !selectedIds.includes(a.studentId));
            });
            
            closeModal();
            renderStudentsManagement();
            showNotification(`${selectedIds.length} siswa berhasil dihapus!`, 'success');
        }

        // Teacher attendance functions
        function editTeacherLocation(attendanceId) {
            const attendance = database.teacherAttendance.find(ta => ta.id === attendanceId);
            if (!attendance) return;
            
            const teacher = database.teachers.find(t => t.id === attendance.teacherId);
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-900">Edit Lokasi Kehadiran Guru</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h4 class="font-medium text-blue-800 mb-2">Informasi Kehadiran</h4>
                        <div class="text-sm text-blue-700 space-y-1">
                            <p><strong>Guru:</strong> ${teacher?.name}</p>
                            <p><strong>Tanggal:</strong> ${attendance.date} ${attendance.time}</p>
                            <p><strong>Mata Pelajaran:</strong> ${attendance.subject}</p>
                            <p><strong>Kelas:</strong> ${attendance.class}</p>
                        </div>
                    </div>
                    
                    <form onsubmit="updateTeacherLocation(event, ${attendanceId})" class="space-y-4">
                        <div>
                            <label for="editLocation" class="block text-sm font-medium text-gray-700 mb-2">Lokasi</label>
                            <input type="text" id="editLocation" value="${attendance.location}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="editCoordinates" class="block text-sm font-medium text-gray-700 mb-2">Koordinat</label>
                            <input type="text" id="editCoordinates" value="${attendance.coordinates}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="-6.200000, 106.816666">
                            <p class="text-xs text-gray-500 mt-1">Format: latitude, longitude</p>
                        </div>
                        
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                                Batal
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                <i class="fas fa-save mr-2"></i>Update Lokasi
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        function updateTeacherLocation(event, attendanceId) {
            event.preventDefault();
            
            const location = document.getElementById('editLocation').value.trim();
            const coordinates = document.getElementById('editCoordinates').value.trim();
            
            if (!location || !coordinates) {
                showNotification('Lokasi dan koordinat harus diisi!', 'error');
                return;
            }
            
            // Validate coordinates format
            const coordPattern = /^-?\d+\.?\d*,\s*-?\d+\.?\d*$/;
            if (!coordPattern.test(coordinates)) {
                showNotification('Format koordinat tidak valid! Gunakan format: latitude, longitude', 'error');
                return;
            }
            
            updateDatabase(() => {
                const attendanceIndex = database.teacherAttendance.findIndex(ta => ta.id === attendanceId);
                if (attendanceIndex !== -1) {
                    database.teacherAttendance[attendanceIndex].location = location;
                    database.teacherAttendance[attendanceIndex].coordinates = coordinates;
                }
            });
            
            closeModal();
            renderTeacherAttendance();
            showNotification('Lokasi kehadiran guru berhasil diupdate!', 'success');
        }

        function deleteTeacherAttendance(attendanceId) {
            const attendance = database.teacherAttendance.find(ta => ta.id === attendanceId);
            if (!attendance) return;
            
            const teacher = database.teachers.find(t => t.id === attendance.teacherId);
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-red-600">Konfirmasi Hapus Data Kehadiran Guru</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>
                                <div>
                                    <h4 class="font-medium text-red-800">Peringatan!</h4>
                                    <p class="text-red-700 text-sm mt-1">Data kehadiran guru yang dihapus tidak dapat dikembalikan.</p>
                                </div>
                            </div>
                        </div>
                        
                        <p class="text-gray-700">Apakah Anda yakin ingin menghapus data kehadiran berikut?</p>
                        <div class="mt-3 p-3 bg-gray-50 rounded-lg">
                            <p class="font-medium">${teacher?.name}</p>
                            <p class="text-sm text-gray-600">Tanggal: ${attendance.date} ${attendance.time}</p>
                            <p class="text-sm text-gray-600">Mata Pelajaran: ${attendance.subject}</p>
                            <p class="text-sm text-gray-600">Kelas: ${attendance.class}</p>
                            <p class="text-sm text-gray-600">Lokasi: ${attendance.location}</p>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Batal
                        </button>
                        <button onclick="confirmDeleteTeacherAttendance(${attendanceId})" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            <i class="fas fa-trash mr-2"></i>Hapus Data
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        function confirmDeleteTeacherAttendance(attendanceId) {
            const attendance = database.teacherAttendance.find(ta => ta.id === attendanceId);
            const teacher = database.teachers.find(t => t.id === attendance.teacherId);
            
            updateDatabase(() => {
                database.teacherAttendance = database.teacherAttendance.filter(ta => ta.id !== attendanceId);
            });
            
            closeModal();
            renderTeacherAttendance();
            showNotification(`Data kehadiran ${teacher?.name} berhasil dihapus!`, 'success');
        }

        // Bulk delete functions
        function toggleAllAttendanceSelection() {
            const selectAll = document.getElementById('selectAllAttendance');
            const checkboxes = document.querySelectorAll('.attendance-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }

        function toggleAllTeacherAttendanceSelection() {
            const selectAll = document.getElementById('selectAllTeacherAttendance');
            const checkboxes = document.querySelectorAll('.teacher-attendance-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }

        function showBulkDeleteAttendance() {
            const selectedCheckboxes = document.querySelectorAll('.attendance-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                showNotification('Pilih minimal satu data absensi untuk dihapus!', 'error');
                return;
            }
            
            const selectedIds = Array.from(selectedCheckboxes).map(cb => parseInt(cb.value));
            const selectedAttendance = database.attendance.filter(att => selectedIds.includes(att.id));
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-red-600">Konfirmasi Hapus Data Absensi Massal</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>
                                <div>
                                    <h4 class="font-medium text-red-800">Peringatan!</h4>
                                    <p class="text-red-700 text-sm mt-1">Data absensi yang dihapus tidak dapat dikembalikan.</p>
                                </div>
                            </div>
                        </div>
                        
                        <p class="text-gray-700 mb-4">Apakah Anda yakin ingin menghapus <strong>${selectedAttendance.length}</strong> data absensi yang dipilih?</p>
                        
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 max-h-40 overflow-y-auto">
                            <h4 class="font-medium text-gray-800 mb-2">Data yang akan dihapus:</h4>
                            ${selectedAttendance.map(att => {
                                const student = database.students.find(s => s.id === att.studentId);
                                return `
                                    <div class="flex justify-between items-center py-1 text-sm border-b border-gray-200 last:border-b-0">
                                        <span>${student?.name} - ${att.subject}</span>
                                        <span class="text-gray-500">${att.date}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Batal
                        </button>
                        <button onclick="confirmBulkDeleteAttendance([${selectedIds.join(',')}])" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            <i class="fas fa-trash mr-2"></i>Hapus ${selectedAttendance.length} Data
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        function showBulkDeleteTeacherAttendance() {
            const selectedCheckboxes = document.querySelectorAll('.teacher-attendance-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                showNotification('Pilih minimal satu data kehadiran guru untuk dihapus!', 'error');
                return;
            }
            
            const selectedIds = Array.from(selectedCheckboxes).map(cb => parseInt(cb.value));
            const selectedAttendance = database.teacherAttendance.filter(att => selectedIds.includes(att.id));
            
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-red-600">Konfirmasi Hapus Data Kehadiran Guru Massal</h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>
                                <div>
                                    <h4 class="font-medium text-red-800">Peringatan!</h4>
                                    <p class="text-red-700 text-sm mt-1">Data kehadiran guru yang dihapus tidak dapat dikembalikan.</p>
                                </div>
                            </div>
                        </div>
                        
                        <p class="text-gray-700 mb-4">Apakah Anda yakin ingin menghapus <strong>${selectedAttendance.length}</strong> data kehadiran guru yang dipilih?</p>
                        
                        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 max-h-40 overflow-y-auto">
                            <h4 class="font-medium text-gray-800 mb-2">Data yang akan dihapus:</h4>
                            ${selectedAttendance.map(att => {
                                const teacher = database.teachers.find(t => t.id === att.teacherId);
                                return `
                                    <div class="flex justify-between items-center py-1 text-sm border-b border-gray-200 last:border-b-0">
                                        <span>${teacher?.name} - ${att.subject}</span>
                                        <span class="text-gray-500">${att.date} ${att.time}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button onclick="closeModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Batal
                        </button>
                        <button onclick="confirmBulkDeleteTeacherAttendance([${selectedIds.join(',')}])" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            <i class="fas fa-trash mr-2"></i>Hapus ${selectedAttendance.length} Data
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('modalContainer').classList.remove('hidden');
        }

        function confirmBulkDeleteAttendance(selectedIds) {
            updateDatabase(() => {
                database.attendance = database.attendance.filter(att => !selectedIds.includes(att.id));
            });
            
            closeModal();
            renderAttendanceReports();
            showNotification(`${selectedIds.length} data absensi berhasil dihapus!`, 'success');
        }

        function confirmBulkDeleteTeacherAttendance(selectedIds) {
            updateDatabase(() => {
                database.teacherAttendance = database.teacherAttendance.filter(att => !selectedIds.includes(att.id));
            });
            
            closeModal();
            renderTeacherAttendance();
            showNotification(`${selectedIds.length} data kehadiran guru berhasil dihapus!`, 'success');
        }

        // Handle Enter key on login
        document.getElementById('uniqueCode').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                handleLogin(event);
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'990f3996f459fe8a',t:'MTc2MDg2NTg5NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
